<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="theme-color" content="#206bc4">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  
  <title>Settings | Minipass</title>
  
  <!-- Favicons -->
  <link rel="icon" type="image/svg+xml" href="/static/favicon.svg">
  <link rel="icon" type="image/png" href="/static/favicon.png">
  <link rel="apple-touch-icon" href="/static/apple-touch-icon.png">
  
  <!-- Font Preconnects -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Anton&family=Inter:wght@300;400;500;600;700&family=Roboto+Slab:wght@400;500;600;700&display=swap" rel="stylesheet">
  
  <!-- Tabler Core CSS -->
  <link href="/static/tabler/css/tabler.min.css" rel="stylesheet"/>
  <link href="/static/tabler/icons/tabler-icons.min.css" rel="stylesheet"/>
  
  <!-- Custom Styles -->
  <link href="/static/minipass.css?v=5662573" rel="stylesheet">
  
  <!-- Global Dropdown Fix -->
  <link href="/static/css/dropdown-fix.css?v=3.1" rel="stylesheet">
  
  <!-- Reusable Components -->
  <link href="/static/css/search-component.css?v=1.0" rel="stylesheet">
  <link href="/static/css/filter-component.css?v=1.0" rel="stylesheet">
  
  <!-- Enhanced Flash Alert Overlay Styles -->
  <style>
    /* Modern notification system with enhanced design */
    .flash-alert-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      z-index: 9999;
      pointer-events: none;
      padding: 1.5rem;
      padding-top: 1rem;
    }
    
    .flash-alert-container {
      max-width: 480px;
      margin: 0 auto;
      display: flex;
      flex-direction: column;
      gap: 0.75rem;
    }
    
    .flash-alert {
      pointer-events: auto;
      position: relative;
      transform: translateY(-120%) scale(0.95);
      opacity: 0;
      transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
      border-radius: 12px;
      border: none;
      overflow: hidden;
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      box-shadow: 
        0 8px 32px rgba(0, 0, 0, 0.12),
        0 2px 8px rgba(0, 0, 0, 0.08),
        inset 0 1px 0 rgba(255, 255, 255, 0.1);
    }
    
    .flash-alert::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 3px;
      background: linear-gradient(90deg, currentColor, transparent);
      opacity: 0.6;
    }
    
    .flash-alert.show {
      transform: translateY(0) scale(1);
      opacity: 1;
    }
    
    .flash-alert.hide {
      transform: translateY(-120%) scale(0.95);
      opacity: 0;
    }
    
    /* Enhanced alert content layout */
    .flash-alert .d-flex {
      align-items: flex-start;
      padding: 1rem 1.25rem;
      gap: 0.875rem;
    }
    
    .flash-alert .alert-icon {
      font-size: 1.25rem;
      margin-top: 0.125rem;
      opacity: 0.9;
    }
    
    .flash-alert .alert-title {
      font-size: 0.95rem;
      font-weight: 600;
      margin-bottom: 0.25rem;
      line-height: 1.3;
    }
    
    .flash-alert .alert-message {
      font-size: 0.875rem;
      line-height: 1.4;
      opacity: 0.9;
    }
    
    .flash-alert .btn-close {
      opacity: 0.6;
      transition: all 0.2s ease;
      margin-top: 0.125rem;
      width: 18px;
      height: 18px;
      background-size: 12px;
    }
    
    .flash-alert .btn-close:hover {
      opacity: 1;
      transform: scale(1.1);
    }
    
    /* Modern color schemes with gradients */
    .flash-alert.alert-success {
      background: linear-gradient(135deg, rgba(16, 185, 129, 0.95) 0%, rgba(5, 150, 105, 0.95) 100%);
      color: white;
      border: 1px solid rgba(255, 255, 255, 0.2);
    }
    
    .flash-alert.alert-success::before {
      background: linear-gradient(90deg, rgba(255, 255, 255, 0.8), transparent);
    }
    
    .flash-alert.alert-danger {
      background: linear-gradient(135deg, rgba(239, 68, 68, 0.95) 0%, rgba(220, 38, 38, 0.95) 100%);
      color: white;
      border: 1px solid rgba(255, 255, 255, 0.2);
    }
    
    .flash-alert.alert-danger::before {
      background: linear-gradient(90deg, rgba(255, 255, 255, 0.8), transparent);
    }
    
    .flash-alert.alert-warning {
      background: linear-gradient(135deg, rgba(245, 158, 11, 0.95) 0%, rgba(217, 119, 6, 0.95) 100%);
      color: white;
      border: 1px solid rgba(255, 255, 255, 0.2);
    }
    
    .flash-alert.alert-warning::before {
      background: linear-gradient(90deg, rgba(255, 255, 255, 0.8), transparent);
    }
    
    .flash-alert.alert-info {
      background: linear-gradient(135deg, rgba(59, 130, 246, 0.95) 0%, rgba(37, 99, 235, 0.95) 100%);
      color: white;
      border: 1px solid rgba(255, 255, 255, 0.2);
    }
    
    .flash-alert.alert-info::before {
      background: linear-gradient(90deg, rgba(255, 255, 255, 0.8), transparent);
    }
    
    /* Subtle hover interaction */
    .flash-alert:hover {
      transform: translateY(-2px) scale(1.02);
      box-shadow: 
        0 12px 40px rgba(0, 0, 0, 0.15),
        0 4px 12px rgba(0, 0, 0, 0.1),
        inset 0 1px 0 rgba(255, 255, 255, 0.15);
    }
    
    /* Progress bar for auto-dismiss */
    .flash-alert-progress {
      position: absolute;
      bottom: 0;
      left: 0;
      height: 2px;
      background: rgba(255, 255, 255, 0.4);
      transform-origin: left;
      animation: flashProgress 5s linear;
    }
    
    @keyframes flashProgress {
      from { transform: scaleX(1); }
      to { transform: scaleX(0); }
    }
    
    /* Enhanced mobile responsiveness */
    @media (max-width: 768px) {
      .flash-alert-overlay {
        padding: 1rem 0.875rem;
        padding-top: 0.75rem;
      }
      
      .flash-alert-container {
        max-width: none;
        gap: 0.625rem;
      }
      
      .flash-alert {
        border-radius: 10px;
        margin: 0;
      }
      
      .flash-alert .d-flex {
        padding: 0.875rem 1rem;
        gap: 0.75rem;
      }
      
      .flash-alert .alert-title {
        font-size: 0.9rem;
      }
      
      .flash-alert .alert-message {
        font-size: 0.8rem;
      }
    }
    
    /* Dark mode compatibility */
    @media (prefers-color-scheme: dark) {
      .flash-alert {
        box-shadow: 
          0 8px 32px rgba(0, 0, 0, 0.3),
          0 2px 8px rgba(0, 0, 0, 0.2),
          inset 0 1px 0 rgba(255, 255, 255, 0.05);
      }
    }
    
    /* Accessibility enhancements */
    @media (prefers-reduced-motion: reduce) {
      .flash-alert {
        transition: opacity 0.2s ease;
        animation: none;
      }
      
      .flash-alert-progress {
        animation: none;
      }
    }
    
    /* Focus management for keyboard users */
    .flash-alert:focus-within {
      outline: 2px solid rgba(255, 255, 255, 0.8);
      outline-offset: 2px;
    }
  </style>
  
  <!-- Typography System - Roboto Slab for H1, Inter for H2 -->
  <style>
    /* Vibrant Gradient Organization Name */
    .org-name-gradient {
      font-family: 'Anton', sans-serif;
      font-weight: 400;
      font-size: 1.8rem;
      background: linear-gradient(90deg, #1a73e8 0%, #6c4edb 25%, #db4ed4 50%, #6c4edb 75%, #1a73e8 100%);
      background-size: 200% 200%;
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      text-fill-color: transparent;
      letter-spacing: 0.02em;
      position: relative;
      display: inline-block;
      filter: drop-shadow(1px 1px 0px rgba(160, 160, 160, 0.8));
      animation: gradientShift 7s ease infinite;
    }
    
    /* Gradient animation keyframes */
    @keyframes gradientShift {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }
    
    /* Mobile responsiveness */
    @media (max-width: 768px) {
      .org-name-gradient {
        font-size: 1.5rem;
      }
      
      /* Center organization name on mobile only */
      .minipass-org-name {
        justify-content: center !important;
        flex: 1;
      }
    }
    
    h1 {
      font-family: 'Roboto Slab', serif !important;
      font-weight: 600 !important;
      font-size: 2rem !important;
      color: #1a1f36 !important;
      letter-spacing: -0.02em !important;
      line-height: 1.2 !important;
    }
    
    h2 {
      font-family: 'Roboto Slab', serif !important;
      font-weight: 600 !important;
      font-size: 1.7rem !important;
      color: #2d3748 !important;
      letter-spacing: -0.02em !important;
      line-height: 1.3 !important;
    }
    
    /* Logo sizing and static hover state override */
    .brand-logo-static {
      width: auto !important;
      height: 23px !important; /* Reduced by ~18% from 28px */
      max-width: 150px !important;
      max-height: 23px !important;
      object-fit: contain;
      transition: none !important; /* Remove all transitions */
      display: block;
      margin: 0;
    }
    
    /* Remove hover effects on brand link when logo is static */
    .brand-link:hover {
      background: none !important;
      transform: none !important;
    }
    
    /* Remove hover effects specifically on the static logo */
    .brand-link:hover .brand-logo-static {
      transform: none !important;
      transition: none !important;
    }
  </style>
  
  
<!-- Admin Settings Enhanced CSS -->
<link href="/static/css/admin-settings.css" rel="stylesheet">

<!-- Settings page uses dashboard-container for consistent alignment -->
<style>
/* Import dashboard container styles if not already available */
.dashboard-container {
  max-width: 1400px;
  margin: 0 auto;
  padding: 0 1.5rem;
}

/* Match dashboard card styling */
.card {
  background: rgba(255, 255, 255, 0.95) !important;
  border: none !important;
  border-radius: 16px !important;
  box-shadow: 0 0.25rem 0.75rem rgba(0, 0, 0, 0.04) !important;
}

/* Settings Header Button Alignment - Force Right Alignment */
.page-header .dashboard-container > .d-flex {
  width: 100% !important;
  display: flex !important;
  justify-content: space-between !important;
  align-items: center !important;
}

.page-header .d-flex:last-child {
  margin-left: auto !important;
  flex-shrink: 0 !important;
}

/* Responsive adjustments */
@media (max-width: 768px) {
  .dashboard-container {
    padding: 0 1rem;
  }
  
  /* Ensure button stays aligned on mobile */
  .page-header .dashboard-container > .d-flex {
    flex-wrap: nowrap !important;
  }
  
  .page-header .btn-success {
    white-space: nowrap;
    flex-shrink: 0;
  }
}
</style>

</head>
<body class="antialiased">

  <!-- Skip Navigation for Accessibility -->
  <a href="#main-content" class="visually-hidden-focusable">Skip to main content</a>
  
  <!-- Fixed Position Flash Alert Overlay -->
  
    
  

  <!-- Main Application Container -->
  <div class="minipass-app">
    
    <!-- Clean Sidebar Navigation (NO USER PROFILE) -->
    <nav class="minipass-sidebar" id="sidebar">
      <!-- Brand Section -->
      <div class="minipass-sidebar-brand">
        <a href="/dashboard" class="brand-link">
          <img src="/static/assets/brand/logo/primary/logo.png?v=20250815" 
               alt="Minipass" class="brand-logo brand-logo-static">
        </a>
        <!-- Mobile close button -->
        <button class="sidebar-close d-lg-none" type="button" id="sidebarClose">
          <i class="ti ti-x"></i>
        </button>
      </div>
      
      <!-- Main Navigation -->
      <div class="minipass-sidebar-nav">
        <!-- Primary Navigation -->
        <div class="nav-section">
          <ul class="nav-list">
            <li class="nav-item">
              <a href="/dashboard" 
                 class="nav-link ">
                <i class="nav-icon ti ti-layout-dashboard"></i>
                <span class="nav-text">Dashboard</span>
                
              </a>
            </li>
            <li class="nav-item">
              <a href="/activities" 
                 class="nav-link ">
                <i class="nav-icon ti ti-activity"></i>
                <span class="nav-text">Activities</span>
                
              </a>
            </li>
            <li class="nav-item">
              <a href="/signups" 
                 class="nav-link ">
                <i class="nav-icon ti ti-user-check"></i>
                <span class="nav-text">Signups</span>
                
                
              </a>
            </li>
            <li class="nav-item">
              <a href="/passports" 
                 class="nav-link ">
                <i class="nav-icon ti ti-ticket"></i>
                <span class="nav-text">Passports</span>
                
                
              </a>
            </li>
            <li class="nav-item">
              <a href="/surveys" 
                 class="nav-link ">
                <i class="nav-icon ti ti-clipboard-check"></i>
                <span class="nav-text">Surveys</span>
                
              </a>
            </li>
          </ul>
        </div>
        
        <!-- Tools Section -->
        <div class="nav-section">
          <ul class="nav-list">
            <li class="nav-item">
              <a href="/chatbot/" 
                 class="nav-link ">
                <i class="nav-icon ti ti-message-chatbot"></i>
                <span class="nav-text">AI Analytics</span>
                <span class="nav-tag">Beta</span>
                
              </a>
            </li>
            <li class="nav-item nav-item-expandable">
              <a href="#" 
                 class="nav-link nav-link-expandable active"
                 data-bs-toggle="collapse" 
                 data-bs-target="#settings-submenu"
                 aria-expanded="true">
                <i class="nav-icon ti ti-settings"></i>
                <span class="nav-text">Settings</span>
                <i class="nav-chevron ti ti-chevron-right"></i>
                
                <span class="nav-indicator"></span>
                
              </a>
              <div class="collapse nav-submenu show" id="settings-submenu">
                <ul class="nav-list">
                  <li class="nav-item">
                    <a href="/setup" class="nav-link" data-tab="admins">
                      <i class="nav-icon ti ti-users"></i>
                      <span class="nav-text">Admin Accounts</span>
                    </a>
                  </li>
                  <li class="nav-item">
                    <a href="/setup" class="nav-link" data-tab="org">
                      <i class="nav-icon ti ti-building"></i>
                      <span class="nav-text">Organization</span>
                    </a>
                  </li>
                  <li class="nav-item">
                    <a href="/setup" class="nav-link" data-tab="email">
                      <i class="nav-icon ti ti-mail"></i>
                      <span class="nav-text">Email Settings</span>
                    </a>
                  </li>
                  <li class="nav-item">
                    <a href="/payment-bot-settings" class="nav-link ">
                      <i class="nav-icon ti ti-robot"></i>
                      <span class="nav-text">Email Parser Payment Bot</span>
                      
                    </a>
                  </li>
                  <li class="nav-item">
                    <a href="/setup" class="nav-link" data-tab="email-templates">
                      <i class="nav-icon ti ti-template"></i>
                      <span class="nav-text">Email Notification</span>
                    </a>
                  </li>
                  <li class="nav-item">
                    <a href="/setup" class="nav-link" data-tab="data">
                      <i class="nav-icon ti ti-database"></i>
                      <span class="nav-text">Your Data</span>
                    </a>
                  </li>
                  <li class="nav-item">
                    <a href="/setup" class="nav-link" data-tab="backup">
                      <i class="nav-icon ti ti-archive"></i>
                      <span class="nav-text">Backup & Restore</span>
                    </a>
                  </li>
                </ul>
              </div>
            </li>
          </ul>
        </div>
      </div>
    </nav>
    
    <!-- Main Content Area -->
    <div class="minipass-main">
      <!-- Header with Organization Name (Left) + User Avatar (Right) -->
      <header class="minipass-header">
        <div class="minipass-header-container">
          <!-- Mobile menu toggle -->
          <button class="header-menu-toggle d-lg-none d-flex align-items-center justify-content-center" type="button" id="sidebarToggle">
            <i class="ti ti-menu-2"></i>
          </button>
          
          <!-- Organization Name (centered on mobile, left-aligned on desktop) -->
          <div class="minipass-org-name d-flex align-items-center justify-content-center justify-content-lg-start flex-grow-1 flex-lg-grow-0">
            <span class="org-name-gradient">
              Fondation LHGI
            </span>
          </div>
          
          <!-- User Avatar Section -->
          
        </div>
      </header>
      
      <!-- Scrollable Main Content with Footer at End -->
      <main class="minipass-content" id="main-content">
        <div class="minipass-content-wrapper">
          <!-- Page Content -->
          

<div class="page-wrapper">
  <!-- Page Header -->
  <div class="page-header d-print-none" style="padding-top: 2rem;">
    <div class="dashboard-container">
      <div class="d-flex align-items-center justify-content-between w-100">
        <div class="d-flex align-items-center">
          <h1 class="page-title mb-0"><i class="ti ti-settings fs-1 text-muted me-2"></i>Settings</h1>
        </div>
        <div class="d-flex align-items-center">
          <button type="submit" class="btn btn-success" form="settings-form">
            <i class="ti ti-device-floppy me-2"></i>
            Save Settings
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Page Body -->
  <div class="page-body">
    <div class="dashboard-container">
  <form method="POST" enctype="multipart/form-data" id="settings-form">
    <input type="hidden" name="csrf_token" value="ImZiM2M5NzI3ZWQwZDY4OWZhYTFkYzJlZGI2ODRjOWZmN2VhZGQ0ZTki.aKkSmg.M4I2exIKOVve3B897uTKcg4tMf8">

    <div class="card bg-white">
      <!-- Content Area (Full Width) -->
      <div class="card-body">
            <div class="tab-content">
              <!-- Admins Tab -->
              <div class="tab-pane fade show active" id="tab-admins">
                <h2 class="mb-4">Admin Accounts</h2>
                <!-- Gravatar Information Panel (shown only when needed) -->
<div class="alert alert-info mb-4 d-none" id="gravatar-info-panel" role="alert">
  <div class="d-flex">
    <div>
      <i class="ti ti-info-circle me-2"></i>
    </div>
    <div>
      <h4 class="alert-title">About Admin Avatars</h4>
      <div class="text-muted">
        Some admin accounts don't have a Gravatar profile picture. You can either:
        <a href="https://gravatar.com/connect" target="_blank" class="alert-link">
          Create a free Gravatar account
        </a> or upload a custom avatar image below.
      </div>
    </div>
  </div>
</div>

<!-- Admin List -->
<div id="admin-list">
  
  <div class="card admin-block mb-3" data-loaded="true">
    <div class="card-body">
      <div class="row g-3 align-items-start">
        <!-- Avatar Section -->
        <div class="col-12 col-md-2 text-center">
          <div class="avatar avatar-xl mx-auto mb-2" id="avatar-1" 
               data-email="kdresdell@gmail.com" 
               data-first-name="Ken" 
               data-last-name="Dresdell"
               data-avatar-filename="">
            <!-- Avatar will be loaded via JavaScript -->
          </div>
          <div class="small text-muted admin-name-display" id="name-display-1">
            
              Ken Dresdell
            
          </div>
          <!-- Avatar upload section (hidden by default) -->
          <div class="avatar-upload-section mt-2 d-none" style="font-size: 0.875rem;">
            <label class="btn btn-sm btn-outline-primary" style="cursor: pointer;">
              <i class="ti ti-upload me-1"></i> Upload
              <input type="file" name="admin_avatar_1" 
                     accept="image/*" class="d-none avatar-upload-input" 
                     data-index="1">
            </label>
            <div class="avatar-preview mt-2 d-none">
              <img src="" alt="Preview" class="img-thumbnail" style="max-width: 80px; max-height: 80px;">
            </div>
          </div>
        </div>
        
        <!-- Form Fields -->
        <div class="col-12 col-md-8">
          <div class="row g-3">
            <div class="col-12">
              <label class="form-label">Email Address</label>
              <input type="email" name="admin_email[]" value="kdresdell@gmail.com" 
                     class="form-control admin-email" required>
              <div class="form-hint">Used for login and Gravatar avatar</div>
            </div>
            <div class="col-md-6">
              <label class="form-label">First Name</label>
              <input type="text" name="admin_first_name[]" value="Ken" 
                     class="form-control admin-first-name" placeholder="John">
              <div class="form-hint">Used for display name and avatar initials</div>
            </div>
            <div class="col-md-6">
              <label class="form-label">Last Name</label>
              <input type="text" name="admin_last_name[]" value="Dresdell" 
                     class="form-control admin-last-name" placeholder="Doe">
              <div class="form-hint">Used for display name and avatar initials</div>
            </div>
            <div class="col-12">
              <label class="form-label">Password</label>
              <div class="input-group">
                <input type="password" name="admin_password[]" value="********"
                       class="form-control admin-password" data-is-placeholder="true" required>
                <button class="btn btn-outline-secondary toggle-password" type="button">
                  <i class="ti ti-eye"></i>
                </button>
              </div>
              <div class="password-strength mt-2 d-none">
                <div class="progress progress-sm">
                  <div class="progress-bar" role="progressbar" style="width: 0%"></div>
                </div>
                <div class="form-hint password-strength-text">Leave blank to keep current password</div>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Actions -->
        <div class="col-12 col-md-2 text-end">
          
          <button type="button" class="btn btn-outline-danger remove-admin-btn">
            <i class="ti ti-trash"></i>
            <span class="d-none d-md-inline ms-1">Remove</span>
          </button>
          
        </div>
      </div>
    </div>
  </div>
  
  <div class="card admin-block mb-3" data-loaded="true">
    <div class="card-body">
      <div class="row g-3 align-items-start">
        <!-- Avatar Section -->
        <div class="col-12 col-md-2 text-center">
          <div class="avatar avatar-xl mx-auto mb-2" id="avatar-2" 
               data-email="edresdell@gmail.com" 
               data-first-name="Elizabeth" 
               data-last-name="Dresdell"
               data-avatar-filename="admin_edresdell_gmail_com_1755816968.png">
            <!-- Avatar will be loaded via JavaScript -->
          </div>
          <div class="small text-muted admin-name-display" id="name-display-2">
            
              Elizabeth Dresdell
            
          </div>
          <!-- Avatar upload section (hidden by default) -->
          <div class="avatar-upload-section mt-2 d-none" style="font-size: 0.875rem;">
            <label class="btn btn-sm btn-outline-primary" style="cursor: pointer;">
              <i class="ti ti-upload me-1"></i> Upload
              <input type="file" name="admin_avatar_2" 
                     accept="image/*" class="d-none avatar-upload-input" 
                     data-index="2">
            </label>
            <div class="avatar-preview mt-2 d-none">
              <img src="" alt="Preview" class="img-thumbnail" style="max-width: 80px; max-height: 80px;">
            </div>
          </div>
        </div>
        
        <!-- Form Fields -->
        <div class="col-12 col-md-8">
          <div class="row g-3">
            <div class="col-12">
              <label class="form-label">Email Address</label>
              <input type="email" name="admin_email[]" value="edresdell@gmail.com" 
                     class="form-control admin-email" required>
              <div class="form-hint">Used for login and Gravatar avatar</div>
            </div>
            <div class="col-md-6">
              <label class="form-label">First Name</label>
              <input type="text" name="admin_first_name[]" value="Elizabeth" 
                     class="form-control admin-first-name" placeholder="John">
              <div class="form-hint">Used for display name and avatar initials</div>
            </div>
            <div class="col-md-6">
              <label class="form-label">Last Name</label>
              <input type="text" name="admin_last_name[]" value="Dresdell" 
                     class="form-control admin-last-name" placeholder="Doe">
              <div class="form-hint">Used for display name and avatar initials</div>
            </div>
            <div class="col-12">
              <label class="form-label">Password</label>
              <div class="input-group">
                <input type="password" name="admin_password[]" value="********"
                       class="form-control admin-password" data-is-placeholder="true" required>
                <button class="btn btn-outline-secondary toggle-password" type="button">
                  <i class="ti ti-eye"></i>
                </button>
              </div>
              <div class="password-strength mt-2 d-none">
                <div class="progress progress-sm">
                  <div class="progress-bar" role="progressbar" style="width: 0%"></div>
                </div>
                <div class="form-hint password-strength-text">Leave blank to keep current password</div>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Actions -->
        <div class="col-12 col-md-2 text-end">
          
          <button type="button" class="btn btn-outline-danger remove-admin-btn">
            <i class="ti ti-trash"></i>
            <span class="d-none d-md-inline ms-1">Remove</span>
          </button>
          
        </div>
      </div>
    </div>
  </div>
  
  <div class="card admin-block mb-3" data-loaded="true">
    <div class="card-body">
      <div class="row g-3 align-items-start">
        <!-- Avatar Section -->
        <div class="col-12 col-md-2 text-center">
          <div class="avatar avatar-xl mx-auto mb-2" id="avatar-3" 
               data-email="mfdecoste@gmail.com" 
               data-first-name="Marie-France" 
               data-last-name="Decoste"
               data-avatar-filename="">
            <!-- Avatar will be loaded via JavaScript -->
          </div>
          <div class="small text-muted admin-name-display" id="name-display-3">
            
              Marie-France Decoste
            
          </div>
          <!-- Avatar upload section (hidden by default) -->
          <div class="avatar-upload-section mt-2 d-none" style="font-size: 0.875rem;">
            <label class="btn btn-sm btn-outline-primary" style="cursor: pointer;">
              <i class="ti ti-upload me-1"></i> Upload
              <input type="file" name="admin_avatar_3" 
                     accept="image/*" class="d-none avatar-upload-input" 
                     data-index="3">
            </label>
            <div class="avatar-preview mt-2 d-none">
              <img src="" alt="Preview" class="img-thumbnail" style="max-width: 80px; max-height: 80px;">
            </div>
          </div>
        </div>
        
        <!-- Form Fields -->
        <div class="col-12 col-md-8">
          <div class="row g-3">
            <div class="col-12">
              <label class="form-label">Email Address</label>
              <input type="email" name="admin_email[]" value="mfdecoste@gmail.com" 
                     class="form-control admin-email" required>
              <div class="form-hint">Used for login and Gravatar avatar</div>
            </div>
            <div class="col-md-6">
              <label class="form-label">First Name</label>
              <input type="text" name="admin_first_name[]" value="Marie-France" 
                     class="form-control admin-first-name" placeholder="John">
              <div class="form-hint">Used for display name and avatar initials</div>
            </div>
            <div class="col-md-6">
              <label class="form-label">Last Name</label>
              <input type="text" name="admin_last_name[]" value="Decoste" 
                     class="form-control admin-last-name" placeholder="Doe">
              <div class="form-hint">Used for display name and avatar initials</div>
            </div>
            <div class="col-12">
              <label class="form-label">Password</label>
              <div class="input-group">
                <input type="password" name="admin_password[]" value="********"
                       class="form-control admin-password" data-is-placeholder="true" required>
                <button class="btn btn-outline-secondary toggle-password" type="button">
                  <i class="ti ti-eye"></i>
                </button>
              </div>
              <div class="password-strength mt-2 d-none">
                <div class="progress progress-sm">
                  <div class="progress-bar" role="progressbar" style="width: 0%"></div>
                </div>
                <div class="form-hint password-strength-text">Leave blank to keep current password</div>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Actions -->
        <div class="col-12 col-md-2 text-end">
          
          <button type="button" class="btn btn-outline-danger remove-admin-btn">
            <i class="ti ti-trash"></i>
            <span class="d-none d-md-inline ms-1">Remove</span>
          </button>
          
        </div>
      </div>
    </div>
  </div>
  
</div>

<!-- Add Admin Button -->
<div class="d-flex justify-content-end">
  <button type="button" class="btn btn-primary" id="add-admin-btn">
    <i class="ti ti-plus me-2"></i>
    Add New Admin
  </button>
</div>

<!-- Deletion tracking -->
<input type="hidden" name="deleted_admins" id="deleted_admins">

<!-- Error Container for friendly alerts -->
<div id="admin-errors"></div>

<!-- Custom CSS for avatar initials -->
<style>
.avatar-initials {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: 600;
  font-size: 1.2rem;
  text-transform: uppercase;
  background-size: cover;
  background-position: center;
}

.avatar-initials:empty {
  background: #f8f9fa;
  border: 2px dashed #dee2e6;
}

/* Ensure proper sizing for different avatar sizes */
.avatar.avatar-xl.avatar-initials {
  width: 5rem;
  height: 5rem;
  font-size: 1.4rem;
}

.admin-name-display {
  font-weight: 500;
  margin-top: 0.5rem;
}

@media (max-width: 768px) {
  .admin-name-display {
    font-size: 0.875rem;
  }
}
</style>

<!-- Scripts -->
<script>
document.addEventListener("DOMContentLoaded", function () {
  // MD5 implementation for Gravatar
  function md5(str) {
    // Simple MD5 implementation - good enough for Gravatar
    function rotateLeft(n, s) {
      return (n << s) | (n >>> (32 - s));
    }
    
    function addUnsigned(x, y) {
      const x4 = (x & 0x40000000);
      const y4 = (y & 0x40000000);
      const x8 = (x & 0x80000000);
      const y8 = (y & 0x80000000);
      const result = (x & 0x3FFFFFFF) + (y & 0x3FFFFFFF);
      if (x4 & y4) return (result ^ 0x80000000 ^ x8 ^ y8);
      if (x4 | y4) {
        if (result & 0x40000000) return (result ^ 0xC0000000 ^ x8 ^ y8);
        else return (result ^ 0x40000000 ^ x8 ^ y8);
      } else return (result ^ x8 ^ y8);
    }
    
    function f(x, y, z) { return (x & y) | ((~x) & z); }
    function g(x, y, z) { return (x & z) | (y & (~z)); }
    function h(x, y, z) { return (x ^ y ^ z); }
    function i(x, y, z) { return (y ^ (x | (~z))); }
    
    function ff(a, b, c, d, x, s, ac) {
      a = addUnsigned(a, addUnsigned(addUnsigned(f(b, c, d), x), ac));
      return addUnsigned(rotateLeft(a, s), b);
    }
    
    function gg(a, b, c, d, x, s, ac) {
      a = addUnsigned(a, addUnsigned(addUnsigned(g(b, c, d), x), ac));
      return addUnsigned(rotateLeft(a, s), b);
    }
    
    function hh(a, b, c, d, x, s, ac) {
      a = addUnsigned(a, addUnsigned(addUnsigned(h(b, c, d), x), ac));
      return addUnsigned(rotateLeft(a, s), b);
    }
    
    function ii(a, b, c, d, x, s, ac) {
      a = addUnsigned(a, addUnsigned(addUnsigned(i(b, c, d), x), ac));
      return addUnsigned(rotateLeft(a, s), b);
    }
    
    function convertToWordArray(str) {
      let lWordCount;
      const lMessageLength = str.length;
      const lNumberOfWords_temp1 = lMessageLength + 8;
      const lNumberOfWords_temp2 = (lNumberOfWords_temp1 - (lNumberOfWords_temp1 % 64)) / 64;
      const lNumberOfWords = (lNumberOfWords_temp2 + 1) * 16;
      const lWordArray = Array(lNumberOfWords - 1);
      let lBytePosition = 0;
      let lByteCount = 0;
      while (lByteCount < lMessageLength) {
        lWordCount = (lByteCount - (lByteCount % 4)) / 4;
        lBytePosition = (lByteCount % 4) * 8;
        lWordArray[lWordCount] = (lWordArray[lWordCount] | (str.charCodeAt(lByteCount) << lBytePosition));
        lByteCount++;
      }
      lWordCount = (lByteCount - (lByteCount % 4)) / 4;
      lBytePosition = (lByteCount % 4) * 8;
      lWordArray[lWordCount] = lWordArray[lWordCount] | (0x80 << lBytePosition);
      lWordArray[lNumberOfWords - 2] = lMessageLength << 3;
      lWordArray[lNumberOfWords - 1] = lMessageLength >>> 29;
      return lWordArray;
    }
    
    function wordToHex(lValue) {
      let wordToHexValue = '', wordToHexValue_temp = '', lByte, lCount;
      for (lCount = 0; lCount <= 3; lCount++) {
        lByte = (lValue >>> (lCount * 8)) & 255;
        wordToHexValue_temp = '0' + lByte.toString(16);
        wordToHexValue = wordToHexValue + wordToHexValue_temp.substr(wordToHexValue_temp.length - 2, 2);
      }
      return wordToHexValue;
    }
    
    const x = convertToWordArray(str);
    let a = 0x67452301, b = 0xEFCDAB89, c = 0x98BADCFE, d = 0x10325476;
    const S11 = 7, S12 = 12, S13 = 17, S14 = 22;
    const S21 = 5, S22 = 9, S23 = 14, S24 = 20;
    const S31 = 4, S32 = 11, S33 = 16, S34 = 23;
    const S41 = 6, S42 = 10, S43 = 15, S44 = 21;
    
    for (let k = 0; k < x.length; k += 16) {
      const AA = a, BB = b, CC = c, DD = d;
      a = ff(a, b, c, d, x[k], S11, 0xD76AA478);
      d = ff(d, a, b, c, x[k + 1], S12, 0xE8C7B756);
      c = ff(c, d, a, b, x[k + 2], S13, 0x242070DB);
      b = ff(b, c, d, a, x[k + 3], S14, 0xC1BDCEEE);
      a = ff(a, b, c, d, x[k + 4], S11, 0xF57C0FAF);
      d = ff(d, a, b, c, x[k + 5], S12, 0x4787C62A);
      c = ff(c, d, a, b, x[k + 6], S13, 0xA8304613);
      b = ff(b, c, d, a, x[k + 7], S14, 0xFD469501);
      a = ff(a, b, c, d, x[k + 8], S11, 0x698098D8);
      d = ff(d, a, b, c, x[k + 9], S12, 0x8B44F7AF);
      c = ff(c, d, a, b, x[k + 10], S13, 0xFFFF5BB1);
      b = ff(b, c, d, a, x[k + 11], S14, 0x895CD7BE);
      a = ff(a, b, c, d, x[k + 12], S11, 0x6B901122);
      d = ff(d, a, b, c, x[k + 13], S12, 0xFD987193);
      c = ff(c, d, a, b, x[k + 14], S13, 0xA679438E);
      b = ff(b, c, d, a, x[k + 15], S14, 0x49B40821);
      a = gg(a, b, c, d, x[k + 1], S21, 0xF61E2562);
      d = gg(d, a, b, c, x[k + 6], S22, 0xC040B340);
      c = gg(c, d, a, b, x[k + 11], S23, 0x265E5A51);
      b = gg(b, c, d, a, x[k], S24, 0xE9B6C7AA);
      a = gg(a, b, c, d, x[k + 5], S21, 0xD62F105D);
      d = gg(d, a, b, c, x[k + 10], S22, 0x2441453);
      c = gg(c, d, a, b, x[k + 15], S23, 0xD8A1E681);
      b = gg(b, c, d, a, x[k + 4], S24, 0xE7D3FBC8);
      a = gg(a, b, c, d, x[k + 9], S21, 0x21E1CDE6);
      d = gg(d, a, b, c, x[k + 14], S22, 0xC33707D6);
      c = gg(c, d, a, b, x[k + 3], S23, 0xF4D50D87);
      b = gg(b, c, d, a, x[k + 8], S24, 0x455A14ED);
      a = gg(a, b, c, d, x[k + 13], S21, 0xA9E3E905);
      d = gg(d, a, b, c, x[k + 2], S22, 0xFCEFA3F8);
      c = gg(c, d, a, b, x[k + 7], S23, 0x676F02D9);
      b = gg(b, c, d, a, x[k + 12], S24, 0x8D2A4C8A);
      a = hh(a, b, c, d, x[k + 5], S31, 0xFFFA3942);
      d = hh(d, a, b, c, x[k + 8], S32, 0x8771F681);
      c = hh(c, d, a, b, x[k + 11], S33, 0x6D9D6122);
      b = hh(b, c, d, a, x[k + 14], S34, 0xFDE5380C);
      a = hh(a, b, c, d, x[k + 1], S31, 0xA4BEEA44);
      d = hh(d, a, b, c, x[k + 4], S32, 0x4BDECFA9);
      c = hh(c, d, a, b, x[k + 7], S33, 0xF6BB4B60);
      b = hh(b, c, d, a, x[k + 10], S34, 0xBEBFBC70);
      a = hh(a, b, c, d, x[k + 13], S31, 0x289B7EC6);
      d = hh(d, a, b, c, x[k], S32, 0xEAA127FA);
      c = hh(c, d, a, b, x[k + 3], S33, 0xD4EF3085);
      b = hh(b, c, d, a, x[k + 6], S34, 0x4881D05);
      a = hh(a, b, c, d, x[k + 9], S31, 0xD9D4D039);
      d = hh(d, a, b, c, x[k + 12], S32, 0xE6DB99E5);
      c = hh(c, d, a, b, x[k + 15], S33, 0x1FA27CF8);
      b = hh(b, c, d, a, x[k + 2], S34, 0xC4AC5665);
      a = ii(a, b, c, d, x[k], S41, 0xF4292244);
      d = ii(d, a, b, c, x[k + 7], S42, 0x432AFF97);
      c = ii(c, d, a, b, x[k + 14], S43, 0xAB9423A7);
      b = ii(b, c, d, a, x[k + 5], S44, 0xFC93A039);
      a = ii(a, b, c, d, x[k + 12], S41, 0x655B59C3);
      d = ii(d, a, b, c, x[k + 3], S42, 0x8F0CCC92);
      c = ii(c, d, a, b, x[k + 10], S43, 0xFFEFF47D);
      b = ii(b, c, d, a, x[k + 1], S44, 0x85845DD1);
      a = ii(a, b, c, d, x[k + 8], S41, 0x6FA87E4F);
      d = ii(d, a, b, c, x[k + 15], S42, 0xFE2CE6E0);
      c = ii(c, d, a, b, x[k + 6], S43, 0xA3014314);
      b = ii(b, c, d, a, x[k + 13], S44, 0x4E0811A1);
      a = ii(a, b, c, d, x[k + 4], S41, 0xF7537E82);
      d = ii(d, a, b, c, x[k + 11], S42, 0xBD3AF235);
      c = ii(c, d, a, b, x[k + 2], S43, 0x2AD7D2BB);
      b = ii(b, c, d, a, x[k + 9], S44, 0xEB86D391);
      a = addUnsigned(a, AA);
      b = addUnsigned(b, BB);
      c = addUnsigned(c, CC);
      d = addUnsigned(d, DD);
    }
    
    const temp = wordToHex(a) + wordToHex(b) + wordToHex(c) + wordToHex(d);
    return temp.toLowerCase();
  }

  // Generate initials from name
  function generateInitials(firstName, lastName) {
    const first = (firstName || '').trim();
    const last = (lastName || '').trim();
    
    if (!first && !last) return 'AD'; // Admin Default
    if (!last) return first.charAt(0).toUpperCase();
    return (first.charAt(0) + last.charAt(0)).toUpperCase();
  }

  // Track which admins have no Gravatar
  let adminsWithoutGravatar = new Set();
  
  // Load avatars with smart detection
  function loadAvatars() {
    let hasAnyWithoutGravatar = false;
    const promises = [];
    
    document.querySelectorAll('[id^="avatar-"]').forEach(avatarDiv => {
      const adminBlock = avatarDiv.closest('.admin-block');
      const email = avatarDiv.dataset.email || adminBlock.querySelector('.admin-email')?.value;
      const firstName = avatarDiv.dataset.firstName || adminBlock.querySelector('.admin-first-name')?.value || '';
      const lastName = avatarDiv.dataset.lastName || adminBlock.querySelector('.admin-last-name')?.value || '';
      const avatarFilename = avatarDiv.dataset.avatarFilename;
      const uploadSection = adminBlock.querySelector('.avatar-upload-section');
      
      // Generate initials for fallback
      const initials = generateInitials(firstName, lastName);
      avatarDiv.dataset.initials = initials;
      
      // Check if custom avatar exists
      if (avatarFilename && avatarFilename !== '') {
        // Use custom uploaded avatar
        avatarDiv.style.backgroundImage = `url(/static/uploads/avatars/${avatarFilename})`;
        avatarDiv.textContent = '';
        avatarDiv.classList.remove('avatar-initials');
        if (uploadSection) uploadSection.classList.add('d-none');
      } else if (email) {
        // Try Gravatar
        const emailLower = email.trim().toLowerCase();
        const gravatarHash = md5(emailLower);
        
        const promise = new Promise((resolve) => {
          const testImg = new Image();
          testImg.onload = function() {
            // Gravatar exists, use it
            avatarDiv.style.backgroundImage = `url(https://www.gravatar.com/avatar/${gravatarHash}?s=96)`;
            avatarDiv.textContent = '';
            avatarDiv.classList.remove('avatar-initials');
            if (uploadSection) uploadSection.classList.add('d-none');
            resolve(true);
          };
          testImg.onerror = function() {
            // No Gravatar - show upload option and use initials
            avatarDiv.style.backgroundImage = '';
            avatarDiv.textContent = initials;
            avatarDiv.classList.add('avatar-initials');
            if (uploadSection) uploadSection.classList.remove('d-none');
            adminsWithoutGravatar.add(email);
            hasAnyWithoutGravatar = true;
            resolve(false);
          };
          testImg.src = `https://www.gravatar.com/avatar/${gravatarHash}?d=404&s=96`;
        });
        promises.push(promise);
      } else {
        // No email - just use initials
        avatarDiv.textContent = initials;
        avatarDiv.classList.add('avatar-initials');
        if (uploadSection) uploadSection.classList.remove('d-none');
      }
    });
    
    // After all checks, show/hide the info panel
    Promise.all(promises).then(() => {
      const infoPanel = document.getElementById('gravatar-info-panel');
      if (infoPanel) {
        if (hasAnyWithoutGravatar) {
          infoPanel.classList.remove('d-none');
        } else {
          infoPanel.classList.add('d-none');
        }
      }
    });
  }

  // Update display name
  function updateDisplayName(adminBlock) {
    const firstName = adminBlock.querySelector('.admin-first-name')?.value?.trim() || '';
    const lastName = adminBlock.querySelector('.admin-last-name')?.value?.trim() || '';
    const nameDisplay = adminBlock.querySelector('.admin-name-display');
    
    if (nameDisplay) {
      if (firstName || lastName) {
        nameDisplay.innerHTML = `${firstName} ${lastName}`.trim();
      } else {
        nameDisplay.innerHTML = '<i class="ti ti-user me-1"></i>Admin';
      }
    }
  }

  // Initial load of avatars
  loadAvatars();

  // Handle avatar file uploads
  document.addEventListener('change', function(e) {
    if (e.target.classList.contains('avatar-upload-input')) {
      const file = e.target.files[0];
      const adminBlock = e.target.closest('.admin-block');
      const avatarDiv = adminBlock.querySelector('[id^="avatar-"]');
      const previewSection = adminBlock.querySelector('.avatar-preview');
      const previewImg = previewSection?.querySelector('img');
      
      if (file && file.type.startsWith('image/')) {
        const reader = new FileReader();
        reader.onload = function(e) {
          // Update avatar display
          if (avatarDiv) {
            avatarDiv.style.backgroundImage = `url(${e.target.result})`;
            avatarDiv.textContent = '';
            avatarDiv.classList.remove('avatar-initials');
          }
          // Show preview
          if (previewImg) {
            previewImg.src = e.target.result;
            previewSection.classList.remove('d-none');
          }
        };
        reader.readAsDataURL(file);
      }
    }
  });
  
  // Update avatar and display name on input changes
  document.addEventListener('input', function(e) {
    if (e.target.classList.contains('admin-email') || 
        e.target.classList.contains('admin-first-name') || 
        e.target.classList.contains('admin-last-name')) {
      const adminBlock = e.target.closest('.admin-block');
      const avatarDiv = adminBlock.querySelector('[id^="avatar-"]');
      const uploadSection = adminBlock.querySelector('.avatar-upload-section');
      
      if (avatarDiv) {
        const email = adminBlock.querySelector('.admin-email')?.value || '';
        const firstName = adminBlock.querySelector('.admin-first-name')?.value || '';
        const lastName = adminBlock.querySelector('.admin-last-name')?.value || '';
        const avatarFilename = avatarDiv.dataset.avatarFilename;
        
        // Update avatar data attributes
        avatarDiv.dataset.email = email;
        avatarDiv.dataset.firstName = firstName;
        avatarDiv.dataset.lastName = lastName;
        
        // Generate initials
        const initials = generateInitials(firstName, lastName);
        avatarDiv.dataset.initials = initials;
        
        // Only update avatar if no custom upload
        const fileInput = adminBlock.querySelector('.avatar-upload-input');
        if (!fileInput?.files?.length && !avatarFilename) {
          avatarDiv.textContent = initials;
          avatarDiv.classList.add('avatar-initials');
          
          // Try Gravatar if email exists
          if (email) {
            const emailLower = email.trim().toLowerCase();
            const gravatarHash = md5(emailLower);
            
            const testImg = new Image();
            testImg.onload = function() {
              avatarDiv.style.backgroundImage = `url(https://www.gravatar.com/avatar/${gravatarHash}?s=96)`;
              avatarDiv.textContent = '';
              avatarDiv.classList.remove('avatar-initials');
              if (uploadSection) uploadSection.classList.add('d-none');
              // Remove from no-gravatar set
              adminsWithoutGravatar.delete(email);
              updateGravatarInfoPanel();
            };
            testImg.onerror = function() {
              avatarDiv.style.backgroundImage = '';
              avatarDiv.textContent = initials;
              avatarDiv.classList.add('avatar-initials');
              if (uploadSection) uploadSection.classList.remove('d-none');
              // Add to no-gravatar set
              adminsWithoutGravatar.add(email);
              updateGravatarInfoPanel();
            };
            testImg.src = `https://www.gravatar.com/avatar/${gravatarHash}?d=404&s=96`;
          } else {
            avatarDiv.style.backgroundImage = '';
            if (uploadSection) uploadSection.classList.remove('d-none');
          }
        }
        
        // Update display name
        updateDisplayName(adminBlock);
      }
    }
  });
  
  // Helper to update Gravatar info panel visibility
  function updateGravatarInfoPanel() {
    const infoPanel = document.getElementById('gravatar-info-panel');
    if (infoPanel) {
      if (adminsWithoutGravatar.size > 0) {
        infoPanel.classList.remove('d-none');
      } else {
        infoPanel.classList.add('d-none');
      }
    }
  }

  // Password strength indicator
  document.addEventListener('input', function(e) {
    if (e.target.classList.contains('admin-password')) {
      const password = e.target.value;
      const adminBlock = e.target.closest('.admin-block');
      const strengthDiv = adminBlock.querySelector('.password-strength');
      const progressBar = strengthDiv.querySelector('.progress-bar');
      const strengthText = strengthDiv.querySelector('.password-strength-text');
      
      // Mark as not placeholder once user starts typing
      if (e.target.dataset.isPlaceholder === 'true' && password !== '********') {
        e.target.dataset.isPlaceholder = 'false';
      }
      
      if (password && password !== '********') {
        strengthDiv.classList.remove('d-none');
        
        // Calculate password strength
        let strength = 0;
        let strengthClass = 'bg-danger';
        let strengthMessage = 'Weak password';
        
        if (password.length >= 8) strength += 25;
        if (/[a-z]/.test(password)) strength += 25;
        if (/[A-Z]/.test(password)) strength += 25;
        if (/[0-9]/.test(password)) strength += 12.5;
        if (/[^A-Za-z0-9]/.test(password)) strength += 12.5;
        
        if (strength >= 75) {
          strengthClass = 'bg-success';
          strengthMessage = 'Strong password';
        } else if (strength >= 50) {
          strengthClass = 'bg-warning';
          strengthMessage = 'Fair password';
        }
        
        progressBar.style.width = strength + '%';
        progressBar.className = 'progress-bar ' + strengthClass;
        strengthText.textContent = strengthMessage;
      } else if (password === '' || password === '********') {
        strengthDiv.classList.add('d-none');
      }
    }
  });

  // Toggle password visibility
  document.addEventListener("click", function (e) {
    if (e.target.closest(".toggle-password")) {
      const button = e.target.closest(".toggle-password");
      const group = button.closest(".input-group");
      const input = group.querySelector("input");
      const icon = button.querySelector("i");
      
      if (input.type === "password") {
        input.type = "text";
        icon.classList.replace("ti-eye", "ti-eye-off");
      } else {
        input.type = "password";
        icon.classList.replace("ti-eye-off", "ti-eye");
      }
    }
  });

  // Remove admin with confirmation
  document.addEventListener('click', function(e) {
    if (e.target.closest('.remove-admin-btn')) {
      const button = e.target.closest('.remove-admin-btn');
      const block = button.closest(".admin-block");
      const email = block.querySelector('.admin-email').value;
      
      if (confirm(`Are you sure you want to remove admin: ${email}?`)) {
        // Track deletion
        const deletedField = document.getElementById("deleted_admins");
        let current = deletedField.value ? deletedField.value.split(",") : [];
        if (email && !current.includes(email)) {
          current.push(email);
          deletedField.value = current.join(",");
        }
        
        // Animate removal
        block.style.transition = 'opacity 0.3s, transform 0.3s';
        block.style.opacity = '0';
        block.style.transform = 'translateX(-20px)';
        setTimeout(() => block.remove(), 300);
      }
    }
  });

  // Add new admin
  document.getElementById('add-admin-btn').addEventListener('click', function() {
    const adminList = document.getElementById("admin-list");
    const newIndex = adminList.children.length + 1;
    
    const newCard = document.createElement("div");
    newCard.className = "card admin-block mb-3";
    newCard.style.opacity = '0';
    newCard.innerHTML = `
      <div class="card-body">
        <div class="row g-3 align-items-start">
          <!-- Avatar Section -->
          <div class="col-12 col-md-2 text-center">
            <div class="avatar avatar-xl mx-auto mb-2 avatar-initials" id="avatar-${newIndex}" 
                 data-email="" data-first-name="" data-last-name="" data-avatar-filename="">
              AD
            </div>
            <div class="small text-muted admin-name-display">
              <i class="ti ti-user me-1"></i>
              New Admin
            </div>
            <!-- Avatar upload section -->
            <div class="avatar-upload-section mt-2" style="font-size: 0.875rem;">
              <label class="btn btn-sm btn-outline-primary" style="cursor: pointer;">
                <i class="ti ti-upload me-1"></i> Upload
                <input type="file" name="admin_avatar_${newIndex}" 
                       accept="image/*" class="d-none avatar-upload-input" 
                       data-index="${newIndex}">
              </label>
              <div class="avatar-preview mt-2 d-none">
                <img src="" alt="Preview" class="img-thumbnail" style="max-width: 80px; max-height: 80px;">
              </div>
            </div>
          </div>
          
          <!-- Form Fields -->
          <div class="col-12 col-md-8">
            <div class="row g-3">
              <div class="col-12">
                <label class="form-label">Email Address</label>
                <input type="email" name="admin_email[]" 
                       class="form-control admin-email" required placeholder="admin@example.com">
                <div class="form-hint">Used for login and Gravatar avatar</div>
              </div>
              <div class="col-md-6">
                <label class="form-label">First Name <span class="text-danger">*</span></label>
                <input type="text" name="admin_first_name[]" 
                       class="form-control admin-first-name" placeholder="John" required>
                <div class="form-hint">Required for new admins</div>
              </div>
              <div class="col-md-6">
                <label class="form-label">Last Name</label>
                <input type="text" name="admin_last_name[]" 
                       class="form-control admin-last-name" placeholder="Doe">
                <div class="form-hint">Used for display name and avatar initials</div>
              </div>
              <div class="col-12">
                <label class="form-label">Password</label>
                <div class="input-group">
                  <input type="password" name="admin_password[]" 
                         class="form-control admin-password" required placeholder="Enter password">
                  <button class="btn btn-outline-secondary toggle-password" type="button">
                    <i class="ti ti-eye"></i>
                  </button>
                </div>
                <div class="password-strength mt-2 d-none">
                  <div class="progress progress-sm">
                    <div class="progress-bar" role="progressbar" style="width: 0%"></div>
                  </div>
                  <div class="form-hint password-strength-text">Enter a strong password</div>
                </div>
              </div>
            </div>
          </div>
          
          <!-- Actions -->
          <div class="col-12 col-md-2 text-end">
            <button type="button" class="btn btn-outline-danger remove-admin-btn">
              <i class="ti ti-trash"></i>
              <span class="d-none d-md-inline ms-1">Remove</span>
            </button>
          </div>
        </div>
      </div>
    `;
    
    adminList.appendChild(newCard);
    
    // Animate appearance
    setTimeout(() => {
      newCard.style.transition = 'opacity 0.3s';
      newCard.style.opacity = '1';
    }, 10);
    
    // Focus on email field
    newCard.querySelector('.admin-email').focus();
  });

  // Enhanced form validation
  document.querySelector("form").addEventListener("submit", function (e) {
    // Clear previous errors
    const existingErrors = document.querySelector('.alert-danger');
    if (existingErrors) existingErrors.remove();
    
    let valid = true;
    const errors = [];
    const emails = new Set();

    document.querySelectorAll('.admin-block').forEach(block => {
      const email = block.querySelector('input[name="admin_email[]"]').value.trim();
      const passwordInput = block.querySelector('input[name="admin_password[]"]');
      const password = passwordInput.value.trim();

      // Check for duplicate emails
      if (email) {
        if (emails.has(email.toLowerCase())) {
          errors.push(`Duplicate email address: ${email}`);
          valid = false;
        }
        emails.add(email.toLowerCase());
      }

      // Handle placeholder passwords
      if (password === "********" && passwordInput.dataset.isPlaceholder === "true") {
        passwordInput.value = "";
      }

      // Check if new admin has password and first name
      if (!block.dataset.loaded) {
        const firstName = block.querySelector('input[name="admin_first_name[]"]').value.trim();
        
        if (email && !password) {
          errors.push(`Please enter a password for new admin: ${email}`);
          valid = false;
        }
        
        if (email && !firstName) {
          errors.push(`Please enter a first name for new admin: ${email}`);
          valid = false;
        }
      }
    });

    if (!valid) {
      e.preventDefault();
      
      // Show errors using Tabler alert
      const alertDiv = document.createElement('div');
      alertDiv.className = 'alert alert-danger alert-dismissible mb-3';
      alertDiv.innerHTML = `
        <div class="d-flex">
          <div>
            <i class="ti ti-alert-circle me-2"></i>
          </div>
          <div>
            <h4 class="alert-title">Please fix the following errors:</h4>
            <ul class="mb-0">
              ${errors.map(err => `<li>${err}</li>`).join('')}
            </ul>
          </div>
        </div>
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
      `;
      
      const adminList = document.getElementById('admin-list');
      adminList.parentNode.insertBefore(alertDiv, adminList);
      
      // Scroll to error
      alertDiv.scrollIntoView({ behavior: 'smooth', block: 'center' });
    }
  });
});
</script>
              </div>

              <!-- Organization Tab -->
              <div class="tab-pane fade" id="tab-org">
                <h2 class="mb-4">Organization</h2>
                <!-- Organization Settings with Tabler.io -->
<div class="card mb-4">
  <div class="card-body">

    <!-- Organization Name -->
    <div class="mb-3">
      <label class="form-label">Organization Name</label>
      <input type="text" name="ORG_NAME" class="form-control" value="Fondation LHGI">
    </div>

    <!-- Call-Back Days -->
    <div class="mb-3">
      <label class="form-label">Call-Back Delay (days) if unpaid</label>
      <input type="number" name="CALL_BACK_DAYS" class="form-control" min="0" value="15">
    </div>

    <!-- Default Pass Settings -->
    <div class="mb-3">
      <label class="form-label">Default Pass Amount ($)</label>
      <input type="number" name="default_pass_amount" class="form-control" min="0" value="50">
    </div>

    <div class="mb-3">
      <label class="form-label">Default Session Quantity</label>
      <input type="number" name="default_session_qt" class="form-control" min="1" value="4">
    </div>

    <!-- Email Templates Text -->
    <div class="mb-3">
      <label class="form-label">Email Info Text</label>
      <textarea name="email_info_text" class="form-control" rows="3" placeholder="Additional info text for emails"></textarea>
    </div>

    <div class="mb-3">
      <label class="form-label">Email Footer Text</label>
      <textarea name="email_footer_text" class="form-control" rows="3" placeholder="Footer text for emails"></textarea>
    </div>

    <!-- Activity Tags -->
    <div class="mb-3">
      <label class="form-label">Activity Tags (comma-separated)</label>
      <input type="text" name="activities" class="form-control" value="[]" placeholder="swimming, running, cycling, yoga">
      <div class="form-text">Enter activity categories separated by commas</div>
    </div>

    <!-- Logo Upload -->
    <div class="mb-3">
      <label class="form-label">Upload Logo</label>
    
      <div class="mb-2">
        <img id="logo-preview" 
             src="/static/uploads/flhgi.png" 
             alt="Logo Preview"
             style="max-height: 80px; display: block;">
      </div>
    
      <input type="file" name="ORG_LOGO_FILE" class="form-control" accept="image/*" id="logo-file-input">
    </div>
    
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        const fileInput = document.getElementById("logo-file-input");
        const preview = document.getElementById("logo-preview");
      
        if (fileInput && preview) {
          fileInput.addEventListener("change", function (event) {
            const file = event.target.files[0];
            if (file && file.type.startsWith("image/")) {
              const reader = new FileReader();
              reader.onload = function (e) {
                preview.src = e.target.result;
                preview.style.display = "block";
              };
              reader.readAsDataURL(file);
            } else {
              preview.src = "";
              preview.style.display = "none";
            }
          });
        }
      });
      </script>
      






  </div>
</div>

<!-- Organization Email Configuration -->
<div class="card mb-4">
  <div class="card-header">
    <h4 class="card-title">
      <i class="ti ti-mail"></i>
      Organization Email Settings
    </h4>
    <p class="text-muted mb-0">Configure custom email settings for different organizations</p>
  </div>
  <div class="card-body">
    
    <!-- Organization List -->
    <div id="organizations-list" class="mb-4">
      <div class="d-flex justify-content-between align-items-center mb-3">
        <h5>Configured Organizations</h5>
        <button class="btn btn-primary btn-sm" onclick="showCreateOrgModal()">
          <i class="ti ti-plus"></i>
          Add Organization
        </button>
      </div>
      
      <div id="organizations-container">
        <div class="text-muted text-center py-4">
          <div class="spinner-border spinner-border-sm" role="status">
            <span class="visually-hidden">Loading...</span>
          </div>
          <p class="mt-2 mb-0">Loading organizations...</p>
        </div>
      </div>
    </div>
    
    <!-- Quick Test Organization Button (Development) -->
    <div class="border-top pt-3">
      <h6>Development Tools</h6>
      <button class="btn btn-outline-info btn-sm" onclick="createTestOrg()">
        <i class="ti ti-flask"></i>
        Create LHGI Test Organization
      </button>
      <small class="form-text text-muted">Creates a test organization with provided credentials</small>
    </div>
  </div>
</div>


<!-- JavaScript for Organization Management -->
<script>
// Global variables
let currentOrgId = null;
let isEditMode = false;

// Load organizations on page load
document.addEventListener('DOMContentLoaded', function() {
  loadOrganizations();
});

// Load and display organizations
function loadOrganizations() {
  fetch('/admin/organizations')
    .then(response => response.json())
    .then(data => {
      const container = document.getElementById('organizations-container');
      
      if (data.organizations && data.organizations.length > 0) {
        container.innerHTML = '';
        data.organizations.forEach(org => {
          container.appendChild(createOrganizationCard(org));
        });
      } else {
        container.innerHTML = '<div class="text-muted text-center py-4"><p>No organizations configured yet.</p></div>';
      }
    })
    .catch(error => {
      console.error('Error loading organizations:', error);
      document.getElementById('organizations-container').innerHTML = 
        '<div class="alert alert-danger">Failed to load organizations</div>';
    });
}

// Create organization card HTML
function createOrganizationCard(org) {
  const card = document.createElement('div');
  card.className = 'card mb-3';
  card.innerHTML = `
    <div class="card-body">
      <div class="row align-items-center">
        <div class="col">
          <h6 class="mb-1">${org.name}</h6>
          <p class="text-muted mb-1">
            <i class="ti ti-mail"></i> ${org.full_email}
            ${org.sender_name ? `  Sender: ${org.sender_name}` : ''}
          </p>
          <small class="text-muted">
            Server: ${org.mail_server || 'Not configured'}  
            Status: <span class="badge ${org.email_enabled ? 'bg-success' : 'bg-secondary'}">
              ${org.email_enabled ? 'Enabled' : 'Disabled'}
            </span>
          </small>
        </div>
        <div class="col-auto">
          <div class="btn-group btn-group-sm">
            <button class="btn btn-outline-primary" onclick="testOrganizationEmail(${org.id})" 
                    title="Test Email">
              <i class="ti ti-mail-check"></i>
            </button>
            <button class="btn btn-outline-secondary" onclick="editOrganization(${org.id})" 
                    title="Edit">
              <i class="ti ti-edit"></i>
            </button>
            <button class="btn ${org.email_enabled ? 'btn-outline-warning' : 'btn-outline-success'}" 
                    onclick="toggleOrganizationEmail(${org.id})" 
                    title="${org.email_enabled ? 'Disable' : 'Enable'}">
              <i class="ti ${org.email_enabled ? 'ti-eye-off' : 'ti-eye'}"></i>
            </button>
            <button class="btn btn-outline-danger" onclick="deleteOrganization(${org.id})" 
                    title="Delete">
              <i class="ti ti-trash"></i>
            </button>
          </div>
        </div>
      </div>
    </div>
  `;
  return card;
}

// Show create organization modal
function showCreateOrgModal() {
  isEditMode = false;
  currentOrgId = null;
  document.getElementById('orgModalLabel').textContent = 'Add Organization';
  document.getElementById('orgForm').reset();
  document.getElementById('orgUseTLS').checked = true;
  
  const modal = new bootstrap.Modal(document.getElementById('orgModal'));
  modal.show();
}

// Edit organization
function editOrganization(orgId) {
  // In a real implementation, you'd fetch the organization data
  // For now, just show the modal
  isEditMode = true;
  currentOrgId = orgId;
  document.getElementById('orgModalLabel').textContent = 'Edit Organization';
  
  const modal = new bootstrap.Modal(document.getElementById('orgModal'));
  modal.show();
}

// Save organization (create or update)
function saveOrganization() {
  const form = document.getElementById('orgForm');
  const formData = new FormData(form);
  const data = Object.fromEntries(formData.entries());
  
  // Convert checkbox to boolean
  data.org_mail_use_tls = document.getElementById('orgUseTLS').checked;
  
  const url = isEditMode ? `/admin/organizations/${currentOrgId}/update` : '/admin/organizations/create';
  const method = isEditMode ? 'PUT' : 'POST';
  
  fetch(url, {
    method: method,
    headers: {
      'Content-Type': 'application/json'
    },
    body: JSON.stringify(data)
  })
  .then(response => response.json())
  .then(result => {
    if (result.success) {
      bootstrap.Modal.getInstance(document.getElementById('orgModal')).hide();
      loadOrganizations();
      showAlert(result.message, 'success');
    } else {
      showAlert(result.error || 'Failed to save organization', 'danger');
    }
  })
  .catch(error => {
    console.error('Error saving organization:', error);
    showAlert('Failed to save organization', 'danger');
  });
}

// Test organization email configuration
function testOrganizationEmail(orgId) {
  fetch(`/admin/organizations/${orgId}/test`, {
    method: 'POST'
  })
  .then(response => response.json())
  .then(result => {
    const alertType = result.success ? 'success' : 'danger';
    showAlert(result.message, alertType);
  })
  .catch(error => {
    console.error('Error testing email:', error);
    showAlert('Failed to test email configuration', 'danger');
  });
}

// Toggle organization email enabled/disabled
function toggleOrganizationEmail(orgId) {
  fetch(`/admin/organizations/${orgId}/toggle`, {
    method: 'POST'
  })
  .then(response => response.json())
  .then(result => {
    if (result.success) {
      loadOrganizations();
      showAlert(result.message, 'success');
    } else {
      showAlert(result.error || 'Failed to toggle organization', 'danger');
    }
  })
  .catch(error => {
    console.error('Error toggling organization:', error);
    showAlert('Failed to toggle organization', 'danger');
  });
}

// Delete organization
function deleteOrganization(orgId) {
  if (!confirm('Are you sure you want to deactivate this organization? This will disable its email configuration.')) {
    return;
  }
  
  fetch(`/admin/organizations/${orgId}/delete`, {
    method: 'DELETE'
  })
  .then(response => response.json())
  .then(result => {
    if (result.success) {
      loadOrganizations();
      showAlert(result.message, 'success');
    } else {
      showAlert(result.error || 'Failed to delete organization', 'danger');
    }
  })
  .catch(error => {
    console.error('Error deleting organization:', error);
    showAlert('Failed to delete organization', 'danger');
  });
}

// Create test organization
function createTestOrg() {
  if (!confirm('This will create a test LHGI organization with the provided credentials. Continue?')) {
    return;
  }
  
  fetch('/admin/create-test-org', {
    method: 'POST'
  })
  .then(response => response.json())
  .then(result => {
    if (result.success) {
      loadOrganizations();
      showAlert(result.message, 'success');
    } else {
      showAlert(result.error || 'Failed to create test organization', 'danger');
    }
  })
  .catch(error => {
    console.error('Error creating test organization:', error);
    showAlert('Failed to create test organization', 'danger');
  });
}

// Show alert message
function showAlert(message, type = 'info') {
  // Create alert element
  const alert = document.createElement('div');
  alert.className = `alert alert-${type} alert-dismissible fade show`;
  alert.innerHTML = `
    ${message}
    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
  `;
  
  // Insert at top of organizations section
  const container = document.getElementById('organizations-list');
  container.insertBefore(alert, container.firstChild);
  
  // Auto-dismiss after 5 seconds
  setTimeout(() => {
    if (alert.parentNode) {
      alert.remove();
    }
  }, 5000);
}
</script>

              </div>

              <!-- Email Settings Tab -->
              <div class="tab-pane fade" id="tab-email">
                <h2 class="mb-4">Email Settings</h2>
                <!-- Email Settings Section -->
<div class="mb-4">
  <!-- Mail Server -->
  <div class="mb-3">
    <label class="form-label">Mail Server</label>
    <input type="text" class="form-control" name="mail_server" value="mail.minipass.me" required>
  </div>

  <div class="mb-3">
    <label class="form-label">Mail Port</label>
    <input type="number" class="form-control" name="mail_port" value="587" required>
  </div>

  <div class="form-check mb-3">
    <input type="checkbox" class="form-check-input" name="mail_use_tls" id="mail_use_tls" checked>
    <label class="form-check-label" for="mail_use_tls">Use TLS</label>
  </div>

  <div class="mb-3">
    <label class="form-label">Email Username</label>
    <input type="email" class="form-control" name="mail_username" value="lhgi@minipass.me" required>
  </div>

  <div class="mb-3">
    <label class="form-label">Email Password (Dev Mode)</label>
    <input type="text" class="form-control" name="mail_password_raw" value="monsterinc00" autocomplete="off" spellcheck="false" style="font-family: monospace;">
  </div>

  <div class="mb-3">
    <label class="form-label">Default Sender Email</label>
    <input type="email" class="form-control" name="mail_default_sender" value="lhgi@minipass.me" required>
    <div class="form-text">The email address used as sender for all outgoing emails</div>
  </div>

  <div class="mb-3">
    <label class="form-label">Sender Name</label>
    <input type="text" class="form-control" name="mail_sender_name" value="Fondation LHGI" placeholder="e.g., LHGI, Your Organization">
    <div class="form-text">The display name shown in email clients (e.g., "LHGI &lt;lhgi@minipass.me&gt;")</div>
  </div>
</div>
              </div>

              <!-- Email Notification Tab -->
              <div class="tab-pane fade" id="tab-email-templates">
                <h2 class="mb-4">Email Notification</h2>
                <ul class="nav nav-tabs mb-3" role="tablist">
                  
                    <li class="nav-item" role="presentation">
                      <a href="#tab-pass_created" class="nav-link active" data-bs-toggle="tab" role="tab">
                        Pass Created
                      </a>
                    </li>
                  
                    <li class="nav-item" role="presentation">
                      <a href="#tab-pass_redeemed" class="nav-link " data-bs-toggle="tab" role="tab">
                        Pass Redeemed
                      </a>
                    </li>
                  
                    <li class="nav-item" role="presentation">
                      <a href="#tab-payment_received" class="nav-link " data-bs-toggle="tab" role="tab">
                        Payment Received
                      </a>
                    </li>
                  
                    <li class="nav-item" role="presentation">
                      <a href="#tab-payment_late" class="nav-link " data-bs-toggle="tab" role="tab">
                        Payment Late
                      </a>
                    </li>
                  
                    <li class="nav-item" role="presentation">
                      <a href="#tab-signup" class="nav-link " data-bs-toggle="tab" role="tab">
                        Signup
                      </a>
                    </li>
                  
                    <li class="nav-item" role="presentation">
                      <a href="#tab-survey_invitation" class="nav-link " data-bs-toggle="tab" role="tab">
                        Survey Invitation
                      </a>
                    </li>
                  
                </ul>

                <div class="tab-content">
                  
                    <div class="tab-pane active show" id="tab-pass_created" role="tabpanel">
                      <div class="mb-3 mt-3">
                        <label class="form-label">Subject</label>
                        <input type="text" name="SUBJECT_pass_created" class="form-control" value="LHGI  Votre passe numrique est prte !">
                      </div>
                      <div class="mb-3">
                        <label class="form-label">Title</label>
                        <input type="text" name="TITLE_pass_created" class="form-control" value="Votre passe numrique est prte !">
                      </div>
                      <div class="mb-3">
                        <label class="form-label">Intro</label>
                        <textarea class="form-control tinymce" name="INTRO_pass_created">&lt;p&gt;Bonjour &lt;strong&gt;{{ pass_data.user.name }}&lt;/strong&gt;,&lt;/p&gt;
&lt;p&gt;Bonne nouvelle ! &amp;nbsp;Votre passe num&amp;eacute;rique vient tout juste d&amp;rsquo;&amp;ecirc;tre cr&amp;eacute;&amp;eacute;e !&lt;/p&gt;
&lt;p&gt;Elle vous donne droit &amp;agrave; &amp;nbsp;&lt;strong&gt;{{ pass_data.uses_remaining }}&lt;/strong&gt; &amp;nbsp;participations &amp;agrave; &lt;strong&gt;{{ pass_data.activity.name }}&lt;/strong&gt; &amp;nbsp; &amp;ndash; il ne vous reste plus qu&amp;rsquo;&amp;agrave; en profiter !&lt;/p&gt;</textarea>
                      </div>
                      <div class="mb-3">
                        <label class="form-label">Conclusion</label>
                        <textarea class="form-control tinymce" name="CONCLUSION_pass_created">&lt;p&gt;{% if not pass_data.paid %}&lt;/p&gt;
&lt;p&gt;Petit rappel amical :&lt;/p&gt;
&lt;p&gt;Votre passe n&amp;rsquo;a pas encore &amp;eacute;t&amp;eacute; pay&amp;eacute;e &lt;/p&gt;
&lt;p&gt;Merci de faire un virement de &lt;span style=&#34;text-decoration: underline;&#34;&gt;&lt;strong&gt;{{ &#34;%.2f&#34;|format(pass_data.sold_amt) }}&lt;/strong&gt;&lt;/span&gt; $ &amp;agrave; lhgi@jfgoulet.com afin d&amp;rsquo;activer votre acc&amp;egrave;s.&lt;/p&gt;
&lt;p&gt;{% endif %}&lt;/p&gt;
&lt;p&gt;&amp;nbsp;&lt;/p&gt;
&lt;p&gt; Tous les fonds amass&amp;eacute;s soutiennent directement la Fondation de la Ligue de Hockey Gagnon Image.&lt;/p&gt;
&lt;p&gt;Un &amp;eacute;norme merci de faire partie de notre belle communaut&amp;eacute;!&lt;/p&gt;
&lt;p&gt;&lt;br&gt;&amp;Agrave; tr&amp;egrave;s bient&amp;ocirc;t sur la glace &lt;/p&gt;
&lt;p&gt;&lt;em&gt;&lt;strong&gt;&amp;mdash; L&amp;rsquo;&amp;eacute;quipe de la LHGI&lt;/strong&gt;&lt;/em&gt;&lt;/p&gt;</textarea>
                      </div>
                      <div class="mb-3">
                        <label class="form-label">Theme (Template Name)</label>
                        <select name="THEME_pass_created" class="form-select">
                          
                            <option value="email_survey_invitation.html" >
                              email_survey_invitation
                            </option>
                          
                            <option value="email_survey_invitation.html" >
                              email_survey_invitation
                            </option>
                          
                            <option value="latePayment.html" >
                              latePayment
                            </option>
                          
                            <option value="newPass.html" selected>
                              newPass
                            </option>
                          
                            <option value="paymentReceived.html" >
                              paymentReceived
                            </option>
                          
                            <option value="redeemPass.html" >
                              redeemPass
                            </option>
                          
                            <option value="signup.html" >
                              signup
                            </option>
                          
                        </select>
                      </div>
                    </div>
                  
                    <div class="tab-pane " id="tab-pass_redeemed" role="tabpanel">
                      <div class="mb-3 mt-3">
                        <label class="form-label">Subject</label>
                        <input type="text" name="SUBJECT_pass_redeemed" class="form-control" value="LHGI  Activit confirme !">
                      </div>
                      <div class="mb-3">
                        <label class="form-label">Title</label>
                        <input type="text" name="TITLE_pass_redeemed" class="form-control" value="Une activit a t utilise sur votre passe numrique.">
                      </div>
                      <div class="mb-3">
                        <label class="form-label">Intro</label>
                        <textarea class="form-control tinymce" name="INTRO_pass_redeemed">&lt;p&gt;Bonjour &lt;strong&gt;{{ pass_data.user.name }}&lt;/strong&gt;,&lt;/p&gt;
&lt;p&gt;Nous vous confirmons qu&amp;rsquo;une participation a &amp;eacute;t&amp;eacute; utilis&amp;eacute;e sur votre passe num&amp;eacute;rique pour l&amp;rsquo;activit&amp;eacute; suivante : &lt;strong&gt;{{ pass_data.activity.name }}&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&amp;nbsp;&lt;/p&gt;</textarea>
                      </div>
                      <div class="mb-3">
                        <label class="form-label">Conclusion</label>
                        <textarea class="form-control tinymce" name="CONCLUSION_pass_redeemed">&lt;p&gt;{% if not pass_data.paid %}&lt;/p&gt;
&lt;p&gt;Petit rappel amical :&lt;/p&gt;
&lt;p&gt;Votre passe n&amp;rsquo;a pas encore &amp;eacute;t&amp;eacute; pay&amp;eacute;e &lt;/p&gt;
&lt;p&gt;Merci de faire un virement de &lt;span style=&#34;text-decoration: underline;&#34;&gt;&lt;strong&gt;{{ &#34;%.2f&#34;|format(pass_data.sold_amt) }}&lt;/strong&gt;&lt;/span&gt; $ &amp;agrave; lhgi@jfgoulet.com afin d&amp;rsquo;activer votre acc&amp;egrave;s.&lt;/p&gt;
&lt;p&gt;{% endif %}&lt;/p&gt;
&lt;p&gt;&amp;nbsp;&lt;/p&gt;
&lt;p&gt; Tous les fonds amass&amp;eacute;s soutiennent directement la Fondation de la Ligue de Hockey Gagnon Image.&lt;/p&gt;
&lt;p&gt;Un &amp;eacute;norme merci de faire partie de notre belle communaut&amp;eacute;!&lt;/p&gt;
&lt;p&gt;&lt;br&gt;&amp;Agrave; tr&amp;egrave;s bient&amp;ocirc;t sur la glace &lt;/p&gt;
&lt;p&gt;&lt;em&gt;&lt;strong&gt;&amp;mdash; L&amp;rsquo;&amp;eacute;quipe de la LHGI&lt;/strong&gt;&lt;/em&gt;&lt;/p&gt;</textarea>
                      </div>
                      <div class="mb-3">
                        <label class="form-label">Theme (Template Name)</label>
                        <select name="THEME_pass_redeemed" class="form-select">
                          
                            <option value="email_survey_invitation.html" >
                              email_survey_invitation
                            </option>
                          
                            <option value="email_survey_invitation.html" >
                              email_survey_invitation
                            </option>
                          
                            <option value="latePayment.html" >
                              latePayment
                            </option>
                          
                            <option value="newPass.html" >
                              newPass
                            </option>
                          
                            <option value="paymentReceived.html" >
                              paymentReceived
                            </option>
                          
                            <option value="redeemPass.html" selected>
                              redeemPass
                            </option>
                          
                            <option value="signup.html" >
                              signup
                            </option>
                          
                        </select>
                      </div>
                    </div>
                  
                    <div class="tab-pane " id="tab-payment_received" role="tabpanel">
                      <div class="mb-3 mt-3">
                        <label class="form-label">Subject</label>
                        <input type="text" name="SUBJECT_payment_received" class="form-control" value="LHGI  Paiement confirm !">
                      </div>
                      <div class="mb-3">
                        <label class="form-label">Title</label>
                        <input type="text" name="TITLE_payment_received" class="form-control" value="Votre passe numrique est maintenant active !">
                      </div>
                      <div class="mb-3">
                        <label class="form-label">Intro</label>
                        <textarea class="form-control tinymce" name="INTRO_payment_received">&lt;p&gt;Bonjour &lt;strong&gt;{{ pass_data.user.name }}&lt;/strong&gt;,&lt;/p&gt;
&lt;p&gt;Merci !&amp;nbsp; Nous avons bien re&amp;ccedil;u votre paiement de &lt;span style=&#34;text-decoration: underline;&#34;&gt;&lt;strong&gt;{{ &#34;%.2f&#34;|format(pass_data.sold_amt) }}&lt;/strong&gt;&lt;/span&gt; $.&lt;/p&gt;
&lt;p&gt;&lt;br&gt;Votre passe num&amp;eacute;rique est maintenant active et pr&amp;ecirc;te &amp;agrave; &amp;ecirc;tre utilis&amp;eacute;e pour vos prochaines activit&amp;eacute;s avec la Ligue de Hockey Gagnon Image &lt;/p&gt;
&lt;p&gt;&amp;nbsp;&lt;/p&gt;</textarea>
                      </div>
                      <div class="mb-3">
                        <label class="form-label">Conclusion</label>
                        <textarea class="form-control tinymce" name="CONCLUSION_payment_received">&lt;p&gt;{% if not pass_data.paid %}&lt;/p&gt;
&lt;p&gt;Petit rappel amical :&lt;/p&gt;
&lt;p&gt;Votre passe n&amp;rsquo;a pas encore &amp;eacute;t&amp;eacute; pay&amp;eacute;e &lt;/p&gt;
&lt;p&gt;Merci de faire un virement de &lt;span style=&#34;text-decoration: underline;&#34;&gt;&lt;strong&gt;{{ &#34;%.2f&#34;|format(pass_data.sold_amt) }}&lt;/strong&gt;&lt;/span&gt; $ &amp;agrave; lhgi@jfgoulet.com afin d&amp;rsquo;activer votre acc&amp;egrave;s.&lt;/p&gt;
&lt;p&gt;{% endif %}&lt;/p&gt;
&lt;p&gt;&amp;nbsp;&lt;/p&gt;
&lt;p&gt; Tous les fonds amass&amp;eacute;s soutiennent directement la Fondation de la Ligue de Hockey Gagnon Image.&lt;/p&gt;
&lt;p&gt;Un &amp;eacute;norme merci de faire partie de notre belle communaut&amp;eacute;!&lt;/p&gt;
&lt;p&gt;&lt;br&gt;&amp;Agrave; tr&amp;egrave;s bient&amp;ocirc;t sur la glace &lt;/p&gt;
&lt;p&gt;&lt;em&gt;&lt;strong&gt;&amp;mdash; L&amp;rsquo;&amp;eacute;quipe de la LHGI&lt;/strong&gt;&lt;/em&gt;&lt;/p&gt;</textarea>
                      </div>
                      <div class="mb-3">
                        <label class="form-label">Theme (Template Name)</label>
                        <select name="THEME_payment_received" class="form-select">
                          
                            <option value="email_survey_invitation.html" >
                              email_survey_invitation
                            </option>
                          
                            <option value="email_survey_invitation.html" >
                              email_survey_invitation
                            </option>
                          
                            <option value="latePayment.html" >
                              latePayment
                            </option>
                          
                            <option value="newPass.html" >
                              newPass
                            </option>
                          
                            <option value="paymentReceived.html" selected>
                              paymentReceived
                            </option>
                          
                            <option value="redeemPass.html" >
                              redeemPass
                            </option>
                          
                            <option value="signup.html" >
                              signup
                            </option>
                          
                        </select>
                      </div>
                    </div>
                  
                    <div class="tab-pane " id="tab-payment_late" role="tabpanel">
                      <div class="mb-3 mt-3">
                        <label class="form-label">Subject</label>
                        <input type="text" name="SUBJECT_payment_late" class="form-control" value="LHGI  Rappel - Vous avez une passe numrique en attente de paiement.">
                      </div>
                      <div class="mb-3">
                        <label class="form-label">Title</label>
                        <input type="text" name="TITLE_payment_late" class="form-control" value="Vous avez une passe numrique en attente de paiement!">
                      </div>
                      <div class="mb-3">
                        <label class="form-label">Intro</label>
                        <textarea class="form-control tinymce" name="INTRO_payment_late">&lt;p&gt;Bonjour &lt;strong&gt;{{ pass_data.user.name }}&lt;/strong&gt;,&lt;/p&gt;
&lt;p&gt;Vous avez une passe num&amp;eacute;rique en attente de paiement!&lt;/p&gt;
&lt;p&gt;Pour activer votre acc&amp;egrave;s aux activit&amp;eacute;s, merci de compl&amp;eacute;ter le virement de {&lt;span style=&#34;text-decoration: underline;&#34;&gt;&lt;strong&gt;{{ &#34;%.2f&#34;|format(pass_data.sold_amt) }}&lt;/strong&gt;&lt;/span&gt; $ &amp;agrave; l&amp;rsquo;adresse suivante : lhgi@jfgoulet.com&lt;/p&gt;</textarea>
                      </div>
                      <div class="mb-3">
                        <label class="form-label">Conclusion</label>
                        <textarea class="form-control tinymce" name="CONCLUSION_payment_late">&lt;p&gt; Tous les fonds amass&amp;eacute;s soutiennent directement la Fondation de la Ligue de Hockey Gagnon Image.&lt;/p&gt;
&lt;p&gt;Un &amp;eacute;norme merci de faire partie de notre belle communaut&amp;eacute;!&lt;/p&gt;
&lt;p&gt;&lt;br&gt;&amp;Agrave; tr&amp;egrave;s bient&amp;ocirc;t sur la glace &lt;/p&gt;
&lt;p&gt;&lt;em&gt;&lt;strong&gt;&amp;mdash; L&amp;rsquo;&amp;eacute;quipe de la LHGI&lt;/strong&gt;&lt;/em&gt;&lt;/p&gt;</textarea>
                      </div>
                      <div class="mb-3">
                        <label class="form-label">Theme (Template Name)</label>
                        <select name="THEME_payment_late" class="form-select">
                          
                            <option value="email_survey_invitation.html" >
                              email_survey_invitation
                            </option>
                          
                            <option value="email_survey_invitation.html" >
                              email_survey_invitation
                            </option>
                          
                            <option value="latePayment.html" selected>
                              latePayment
                            </option>
                          
                            <option value="newPass.html" >
                              newPass
                            </option>
                          
                            <option value="paymentReceived.html" >
                              paymentReceived
                            </option>
                          
                            <option value="redeemPass.html" >
                              redeemPass
                            </option>
                          
                            <option value="signup.html" >
                              signup
                            </option>
                          
                        </select>
                      </div>
                    </div>
                  
                    <div class="tab-pane " id="tab-signup" role="tabpanel">
                      <div class="mb-3 mt-3">
                        <label class="form-label">Subject</label>
                        <input type="text" name="SUBJECT_signup" class="form-control" value="LHGI  Votre Inscription est confirme">
                      </div>
                      <div class="mb-3">
                        <label class="form-label">Title</label>
                        <input type="text" name="TITLE_signup" class="form-control" value="Votre Inscription est confirme">
                      </div>
                      <div class="mb-3">
                        <label class="form-label">Intro</label>
                        <textarea class="form-control tinymce" name="INTRO_signup">&lt;p class=&#34;&#34; data-start=&#34;193&#34; data-end=&#34;217&#34;&gt;Bonjour &lt;strong&gt;{{ user_name }}&lt;/strong&gt;,&lt;/p&gt;
&lt;p class=&#34;&#34; data-start=&#34;222&#34; data-end=&#34;276&#34;&gt;Merci de vous &amp;ecirc;tre inscrit &amp;agrave; &lt;strong&gt;{{ activity_name }}&amp;nbsp;&lt;br&gt;&lt;br&gt;&lt;/strong&gt;D&amp;egrave;s r&amp;eacute;ception de votre paiement, votre inscription sera confirm&amp;eacute;e et un passe num&amp;eacute;rique vous sera envoy&amp;eacute;.&lt;/p&gt;</textarea>
                      </div>
                      <div class="mb-3">
                        <label class="form-label">Conclusion</label>
                        <textarea class="form-control tinymce" name="CONCLUSION_signup">&lt;p&gt; Tous les fonds amass&amp;eacute;s soutiennent directement la Fondation de la Ligue de Hockey Gagnon Image.&lt;/p&gt;
&lt;p&gt;Un &amp;eacute;norme merci de faire partie de notre belle communaut&amp;eacute;!&lt;/p&gt;
&lt;p&gt;&lt;br&gt;&amp;Agrave; tr&amp;egrave;s bient&amp;ocirc;t sur la glace &lt;/p&gt;
&lt;p&gt;&lt;em&gt;&lt;strong&gt;&amp;mdash; L&amp;rsquo;&amp;eacute;quipe de la LHGI&lt;/strong&gt;&lt;/em&gt;&lt;/p&gt;</textarea>
                      </div>
                      <div class="mb-3">
                        <label class="form-label">Theme (Template Name)</label>
                        <select name="THEME_signup" class="form-select">
                          
                            <option value="email_survey_invitation.html" >
                              email_survey_invitation
                            </option>
                          
                            <option value="email_survey_invitation.html" >
                              email_survey_invitation
                            </option>
                          
                            <option value="latePayment.html" >
                              latePayment
                            </option>
                          
                            <option value="newPass.html" >
                              newPass
                            </option>
                          
                            <option value="paymentReceived.html" >
                              paymentReceived
                            </option>
                          
                            <option value="redeemPass.html" >
                              redeemPass
                            </option>
                          
                            <option value="signup.html" selected>
                              signup
                            </option>
                          
                        </select>
                      </div>
                    </div>
                  
                    <div class="tab-pane " id="tab-survey_invitation" role="tabpanel">
                      <div class="mb-3 mt-3">
                        <label class="form-label">Subject</label>
                        <input type="text" name="SUBJECT_survey_invitation" class="form-control" value="wrewr">
                      </div>
                      <div class="mb-3">
                        <label class="form-label">Title</label>
                        <input type="text" name="TITLE_survey_invitation" class="form-control" value="rewrewr">
                      </div>
                      <div class="mb-3">
                        <label class="form-label">Intro</label>
                        <textarea class="form-control tinymce" name="INTRO_survey_invitation">&lt;p&gt;werwerwe&lt;/p&gt;</textarea>
                      </div>
                      <div class="mb-3">
                        <label class="form-label">Conclusion</label>
                        <textarea class="form-control tinymce" name="CONCLUSION_survey_invitation">&lt;p&gt;rwerewrewr&lt;/p&gt;</textarea>
                      </div>
                      <div class="mb-3">
                        <label class="form-label">Theme (Template Name)</label>
                        <select name="THEME_survey_invitation" class="form-select">
                          
                            <option value="email_survey_invitation.html" selected>
                              email_survey_invitation
                            </option>
                          
                            <option value="email_survey_invitation.html" selected>
                              email_survey_invitation
                            </option>
                          
                            <option value="latePayment.html" >
                              latePayment
                            </option>
                          
                            <option value="newPass.html" >
                              newPass
                            </option>
                          
                            <option value="paymentReceived.html" >
                              paymentReceived
                            </option>
                          
                            <option value="redeemPass.html" >
                              redeemPass
                            </option>
                          
                            <option value="signup.html" >
                              signup
                            </option>
                          
                        </select>
                      </div>
                    </div>
                  
                </div>
              </div>

              <!-- Your Data Tab -->
              <div class="tab-pane fade" id="tab-data">
                <h2 class="mb-4">Your Data</h2>
                <div class="row">
                  <div class="col-lg-8">
                    <h3 class="mb-4">
                      <i class="ti ti-alert-triangle text-danger me-2"></i>
                      Danger Zone
                    </h3>
                    
                    <div class="card border-danger">
                      <div class="card-header bg-danger-lt">
                        <h4 class="card-title text-danger mb-0">
                          <i class="ti ti-trash me-2"></i>
                          Erase All Application Data
                        </h4>
                      </div>
                      <div class="card-body">
                        <p class="text-muted mb-3">
                          This action will permanently delete all user passes, redemptions, reminders, 
                          e-bank logs, and email logs. This cannot be undone.
                        </p>
                        
                        <div class="alert alert-danger" role="alert">
                          <div class="d-flex">
                            <div>
                              <i class="ti ti-alert-circle me-2"></i>
                            </div>
                            <div>
                              <h4 class="alert-title">Warning!</h4>
                              <div class="text-muted">
                                Make sure you have created a backup before proceeding with this action.
                              </div>
                            </div>
                          </div>
                        </div>
                        
                        <button type="button" class="btn btn-danger" data-bs-toggle="modal" data-bs-target="#confirmEraseModal">
                          <i class="ti ti-trash me-2"></i>
                          Erase All App Data
                        </button>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Backup & Restore Tab -->
              <div class="tab-pane fade" id="tab-backup">
                <h2 class="mb-4">Backup & Restore</h2>
                <div class="row">
                  <div class="col-lg-8">
                    <h3 class="mb-4">
                      <i class="ti ti-database me-2"></i>
                      Database Backup & Restore
                    </h3>
                    
                    <!-- Manual Backup Section -->
                    <div class="card mb-4">
                      <div class="card-header">
                        <h4 class="card-title mb-0">
                          <i class="ti ti-database-export me-2"></i>
                          Create Backup
                        </h4>
                      </div>
                      <div class="card-body">
                        <p class="text-muted mb-3">
                          Generate a backup of your current database. Includes all active data but excludes 
                          settings and admin passwords for security.
                        </p>
                        
                        <button type="button" class="btn btn-primary" onclick="location.href='/generate-backup'">
                          <i class="ti ti-database-export me-2"></i>
                          Create Backup Now
                        </button>
                      </div>
                    </div>
                    
                    <!-- Available Backups Section -->
                    <div class="card">
                      <div class="card-header">
                        <h4 class="card-title mb-0">
                          <i class="ti ti-folder me-2"></i>
                          Available Backups
                        </h4>
                      </div>
                      <div class="card-body">
                        
                          <div class="list-group list-group-flush">
                            
                              <div class="list-group-item d-flex align-items-center justify-content-between">
                                <div class="d-flex align-items-center">
                                  <i class="ti ti-file-zip text-muted me-3"></i>
                                  <div>
                                    <div class="fw-semibold">minipass_backup_2025-05-05_23-22-14.zip</div>
                                    <div class="text-muted small">Database backup file</div>
                                  </div>
                                </div>
                                <a href="/static/backups/minipass_backup_2025-05-05_23-22-14.zip" download class="btn btn-sm btn-outline-primary">
                                  <i class="ti ti-download me-1"></i>
                                  Download
                                </a>
                              </div>
                            
                              <div class="list-group-item d-flex align-items-center justify-content-between">
                                <div class="d-flex align-items-center">
                                  <i class="ti ti-file-zip text-muted me-3"></i>
                                  <div>
                                    <div class="fw-semibold">minipass_backup_2025-05-05_23-22-13.zip</div>
                                    <div class="text-muted small">Database backup file</div>
                                  </div>
                                </div>
                                <a href="/static/backups/minipass_backup_2025-05-05_23-22-13.zip" download class="btn btn-sm btn-outline-primary">
                                  <i class="ti ti-download me-1"></i>
                                  Download
                                </a>
                              </div>
                            
                              <div class="list-group-item d-flex align-items-center justify-content-between">
                                <div class="d-flex align-items-center">
                                  <i class="ti ti-file-zip text-muted me-3"></i>
                                  <div>
                                    <div class="fw-semibold">minipass_backup_2025-05-02_13-14-53.zip</div>
                                    <div class="text-muted small">Database backup file</div>
                                  </div>
                                </div>
                                <a href="/static/backups/minipass_backup_2025-05-02_13-14-53.zip" download class="btn btn-sm btn-outline-primary">
                                  <i class="ti ti-download me-1"></i>
                                  Download
                                </a>
                              </div>
                            
                              <div class="list-group-item d-flex align-items-center justify-content-between">
                                <div class="d-flex align-items-center">
                                  <i class="ti ti-file-zip text-muted me-3"></i>
                                  <div>
                                    <div class="fw-semibold">minipass_backup_2025-05-02_02-43-07.zip</div>
                                    <div class="text-muted small">Database backup file</div>
                                  </div>
                                </div>
                                <a href="/static/backups/minipass_backup_2025-05-02_02-43-07.zip" download class="btn btn-sm btn-outline-primary">
                                  <i class="ti ti-download me-1"></i>
                                  Download
                                </a>
                              </div>
                            
                              <div class="list-group-item d-flex align-items-center justify-content-between">
                                <div class="d-flex align-items-center">
                                  <i class="ti ti-file-zip text-muted me-3"></i>
                                  <div>
                                    <div class="fw-semibold">minipass_backup_2025-05-01_21-05-45.zip</div>
                                    <div class="text-muted small">Database backup file</div>
                                  </div>
                                </div>
                                <a href="/static/backups/minipass_backup_2025-05-01_21-05-45.zip" download class="btn btn-sm btn-outline-primary">
                                  <i class="ti ti-download me-1"></i>
                                  Download
                                </a>
                              </div>
                            
                              <div class="list-group-item d-flex align-items-center justify-content-between">
                                <div class="d-flex align-items-center">
                                  <i class="ti ti-file-zip text-muted me-3"></i>
                                  <div>
                                    <div class="fw-semibold">minipass_backup_2025-04-29_20-01-02.zip</div>
                                    <div class="text-muted small">Database backup file</div>
                                  </div>
                                </div>
                                <a href="/static/backups/minipass_backup_2025-04-29_20-01-02.zip" download class="btn btn-sm btn-outline-primary">
                                  <i class="ti ti-download me-1"></i>
                                  Download
                                </a>
                              </div>
                            
                              <div class="list-group-item d-flex align-items-center justify-content-between">
                                <div class="d-flex align-items-center">
                                  <i class="ti ti-file-zip text-muted me-3"></i>
                                  <div>
                                    <div class="fw-semibold">minipass_backup_2025-04-27_12-53-03.zip</div>
                                    <div class="text-muted small">Database backup file</div>
                                  </div>
                                </div>
                                <a href="/static/backups/minipass_backup_2025-04-27_12-53-03.zip" download class="btn btn-sm btn-outline-primary">
                                  <i class="ti ti-download me-1"></i>
                                  Download
                                </a>
                              </div>
                            
                          </div>
                        
                      </div>
                    </div>
                  </div>
                </div>
              </div>

            </div>
          </div>
    </div>
    </form>
    </div>
  </div>
</div>

<!-- Organization Email Modal -->
<div class="modal fade" id="orgModal" tabindex="-1" aria-labelledby="orgModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="orgModalLabel">Add Organization</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <form id="orgForm">
          <div class="row">
            <div class="col-md-6">
              <div class="mb-3">
                <label for="orgName" class="form-label">Organization Name</label>
                <input type="text" class="form-control" id="orgName" name="org_name" required>
              </div>
            </div>
            <div class="col-md-6">
              <div class="mb-3">
                <label for="orgDomain" class="form-label">Email Domain</label>
                <div class="input-group">
                  <input type="text" class="form-control" id="orgDomain" name="org_domain" required>
                  <span class="input-group-text">@minipass.me</span>
                </div>
                <small class="form-text text-muted">e.g., 'lhgi' for lhgi@minipass.me</small>
              </div>
            </div>
          </div>
          
          <div class="row">
            <div class="col-md-6">
              <div class="mb-3">
                <label for="orgMailServer" class="form-label">Mail Server</label>
                <input type="text" class="form-control" id="orgMailServer" name="org_mail_server" placeholder="mail.minipass.me" required>
              </div>
            </div>
            <div class="col-md-6">
              <div class="mb-3">
                <label for="orgMailPort" class="form-label">Mail Port</label>
                <input type="number" class="form-control" id="orgMailPort" name="org_mail_port" value="587" required>
              </div>
            </div>
          </div>
          
          <div class="row">
            <div class="col-md-6">
              <div class="mb-3">
                <label for="orgMailUsername" class="form-label">Mail Username</label>
                <input type="email" class="form-control" id="orgMailUsername" name="org_mail_username" required>
              </div>
            </div>
            <div class="col-md-6">
              <div class="mb-3">
                <label for="orgMailPassword" class="form-label">Mail Password</label>
                <input type="password" class="form-control" id="orgMailPassword" name="org_mail_password" required>
              </div>
            </div>
          </div>
          
          <div class="row">
            <div class="col-md-6">
              <div class="mb-3">
                <label for="orgSenderName" class="form-label">Sender Name</label>
                <input type="text" class="form-control" id="orgSenderName" name="org_mail_sender_name" placeholder="Organization Name">
              </div>
            </div>
            <div class="col-md-6">
              <div class="mb-3">
                <div class="form-check form-switch">
                  <input class="form-check-input" type="checkbox" id="orgUseTLS" name="org_mail_use_tls" checked>
                  <label class="form-check-label" for="orgUseTLS">Use TLS</label>
                </div>
              </div>
            </div>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
        <button type="button" class="btn btn-primary" onclick="saveOrganization()">Save Organization</button>
      </div>
    </div>
  </div>
</div>

<!-- Modal -->
<div class="modal modal-blur fade" id="confirmEraseModal" tabindex="-1" role="dialog" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered" role="document">
    <div class="modal-content">
      <form method="POST" action="/erase-app-data">
        <input type="hidden" name="csrf_token" value="ImZiM2M5NzI3ZWQwZDY4OWZhYTFkYzJlZGI2ODRjOWZmN2VhZGQ0ZTki.aKkSmg.M4I2exIKOVve3B897uTKcg4tMf8">
        <div class="modal-header">
          <h5 class="modal-title">Confirm Erase</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <p class="text-danger fw-bold">
            This will permanently delete all user passes, redemptions, reminders, e-bank logs, and email logs.<br>
            Are you sure you want to continue?
          </p>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-link link-secondary" data-bs-dismiss="modal">Cancel</button>
          <button type="submit" class="btn btn-danger">Yes, erase everything</button>
        </div>
      </form>
    </div>
  </div>
</div>


          
          <!-- Footer at END of content (scrollable, not sticky) -->
          <footer class="minipass-footer">
            <div class="minipass-footer-content">
              <div class="minipass-footer-text">
                 2025, <b>minipass.me</b> , All rights reserved. # version: v1
              </div>
            </div>
          </footer>
        </div>
      </main>
    </div>
    
    <!-- Mobile Bottom Navigation (PRESERVED EXACTLY) -->
    
  </div>

  <!-- TinyMCE Editor -->
  <script src="/static/tinymce/tinymce.min.js"></script>
  <script>
    document.addEventListener("DOMContentLoaded", function () {
      // Initialize TinyMCE
      if (document.querySelector('textarea.tinymce')) {
        tinymce.init({
          selector: 'textarea.tinymce',
          height: 200,
          plugins: 'link lists code preview',
          toolbar: 'undo redo | bold italic underline | alignleft aligncenter alignright | bullist numlist | link | code preview',
          menubar: false,
          branding: false,
          skin: "oxide",
          content_css: "default"
        });
      }
      
      // Enhanced modern flash alert system
      const flashOverlay = document.getElementById('flashAlertOverlay');
      if (flashOverlay) {
        const flashAlerts = flashOverlay.querySelectorAll('.flash-alert');
        
        // Enhanced show alerts with improved staggered animation
        flashAlerts.forEach((alert, index) => {
          // Set initial state
          alert.style.transitionDelay = `${index * 100}ms`;
          
          // Show with staggered timing
          setTimeout(() => {
            alert.classList.add('show');
            
            // Add subtle entrance sound effect (optional)
            if (window.AudioContext) {
              playNotificationSound(alert.classList.contains('alert-success'));
            }
          }, index * 120); // Slightly faster stagger
          
          // Auto-dismiss with progress bar
          const progressBar = alert.querySelector('.flash-alert-progress');
          if (progressBar) {
            setTimeout(() => {
              progressBar.style.animation = 'flashProgress 5s linear';
            }, 200 + (index * 120));
          }
          
          // Auto-dismiss after 6 seconds (longer for better UX)
          setTimeout(() => {
            dismissFlashAlert(alert);
          }, 6000 + (index * 120));
        });
        
        // Handle manual dismiss with improved interaction
        flashAlerts.forEach(alert => {
          const closeBtn = alert.querySelector('.btn-close');
          if (closeBtn) {
            closeBtn.addEventListener('click', (e) => {
              e.preventDefault();
              dismissFlashAlert(alert);
            });
          }
          
          // Pause auto-dismiss on hover
          let autoDismissTimer;
          alert.addEventListener('mouseenter', () => {
            const progressBar = alert.querySelector('.flash-alert-progress');
            if (progressBar) {
              progressBar.style.animationPlayState = 'paused';
            }
          });
          
          alert.addEventListener('mouseleave', () => {
            const progressBar = alert.querySelector('.flash-alert-progress');
            if (progressBar) {
              progressBar.style.animationPlayState = 'running';
            }
          });
        });
      }
      
      function dismissFlashAlert(alert) {
        // Add hide class with improved animation
        alert.classList.add('hide');
        alert.classList.remove('show');
        
        // Improved cleanup with proper timing
        setTimeout(() => {
          if (alert.parentNode) {
            alert.remove();
          }
          
          // Clean up overlay if no alerts remain
          const overlay = document.getElementById('flashAlertOverlay');
          if (overlay && overlay.querySelectorAll('.flash-alert').length === 0) {
            overlay.remove();
          }
        }, 400); // Match the transition duration
      }
      
      // Optional: Subtle audio feedback for notifications
      function playNotificationSound(isSuccess = false) {
        try {
          const audioContext = new (window.AudioContext || window.webkitAudioContext)();
          const oscillator = audioContext.createOscillator();
          const gainNode = audioContext.createGain();
          
          oscillator.connect(gainNode);
          gainNode.connect(audioContext.destination);
          
          // Different frequencies for different alert types
          oscillator.frequency.setValueAtTime(isSuccess ? 800 : 600, audioContext.currentTime);
          oscillator.type = 'sine';
          
          // Very subtle volume
          gainNode.gain.setValueAtTime(0, audioContext.currentTime);
          gainNode.gain.linearRampToValueAtTime(0.02, audioContext.currentTime + 0.01);
          gainNode.gain.exponentialRampToValueAtTime(0.001, audioContext.currentTime + 0.1);
          
          oscillator.start(audioContext.currentTime);
          oscillator.stop(audioContext.currentTime + 0.1);
        } catch (e) {
          // Silent fail if audio is not supported
        }
      }
      
      // Mobile sidebar toggle
      const sidebarToggle = document.getElementById('sidebarToggle');
      const sidebarClose = document.getElementById('sidebarClose');
      const sidebar = document.getElementById('sidebar');
      
      if (sidebarToggle && sidebar) {
        sidebarToggle.addEventListener('click', function() {
          sidebar.classList.toggle('show');
          document.body.classList.toggle('sidebar-open');
        });
      }
      
      if (sidebarClose && sidebar) {
        sidebarClose.addEventListener('click', function() {
          sidebar.classList.remove('show');
          document.body.classList.remove('sidebar-open');
        });
      }
      
      // Close sidebar when clicking outside
      document.addEventListener('click', function(event) {
        if (!sidebar.contains(event.target) && !sidebarToggle.contains(event.target)) {
          sidebar.classList.remove('show');
          document.body.classList.remove('sidebar-open');
        }
      });
      
      // Settings submenu tab coordination
      const settingsSubmenuLinks = document.querySelectorAll('#settings-submenu .nav-link');
      settingsSubmenuLinks.forEach(link => {
        link.addEventListener('click', function(e) {
          const tabName = this.getAttribute('data-tab');
          if (tabName) {
            // Check if we're on the settings page
            if (window.location.pathname === '/setup') {
              // Prevent navigation and switch tabs directly
              e.preventDefault();
              
              // Call the tab switching function if available
              if (typeof window.showSettingsTab === 'function') {
                window.showSettingsTab(tabName);
              }
              
              // Update active states in submenu
              settingsSubmenuLinks.forEach(l => l.classList.remove('active'));
              this.classList.add('active');
              
              return false;
            } else {
              // Store the selected tab for navigation to settings page
              localStorage.setItem('settings-active-tab', tabName);
            }
          }
        });
      });
    });
  </script>
  
  <!-- Tabler Core JS -->
  <script src="/static/tabler/js/tabler.min.js"></script>
  
  <!-- Global Dropdown Fix -->
  <script src="/static/js/dropdown-fix.js?v=3.1"></script>
  
  <!-- Reusable Components -->
  <script src="/static/js/search-component.js?v=1.0"></script>
  <script src="/static/js/filter-component.js?v=1.0"></script>
  
  
<!-- Email Settings JavaScript -->
<script src="/static/js/email-settings.js"></script>

<script>
document.addEventListener('DOMContentLoaded', function() {
  // Get the stored tab from localStorage
  const storedTab = localStorage.getItem('settings-active-tab') || 'admins';
  
  // Function to show a specific tab
  function showTab(tabName) {
    // Hide all tab panes
    document.querySelectorAll('.tab-pane').forEach(pane => {
      pane.classList.remove('show', 'active');
      pane.classList.add('fade');
    });
    
    // Show the selected tab
    const targetTab = document.getElementById('tab-' + tabName);
    if (targetTab) {
      targetTab.classList.remove('fade');
      targetTab.classList.add('show', 'active');
    }
    
    // Update active state in sidebar submenu
    const submenuLinks = document.querySelectorAll('#settings-submenu .nav-link');
    submenuLinks.forEach(link => {
      const linkTab = link.getAttribute('data-tab');
      if (linkTab === tabName) {
        link.classList.add('active');
      } else {
        link.classList.remove('active');
      }
    });
  }
  
  // Make the function globally available for sidebar navigation
  window.showSettingsTab = showTab;
  
  // Show the stored tab on page load
  showTab(storedTab);
  
  // Clear localStorage after using it (so it doesn't persist across sessions)
  localStorage.removeItem('settings-active-tab');
});
</script>

</body>
</html>